import{r as i,j as e,e as is,u as ds,H as ke,a as L}from"./app-CNJch6fJ.js";import{S as _e,N as ye,A as we,a as Se,B as H,c as cs,d as ms}from"./NotificationListener-CHbz9J81.js";import{I as us,P as ps}from"./pdf-viewer-Bn6ykAGa.js";import{S as Ce}from"./site-header-1ZLAZI7i.js";import{a as xs,e as fs,c as gs,B as j}from"./button-Bc8fY39k.js";import{C as D,a as P,b as A,d as $,c as hs}from"./card-BdiGcNVe.js";import{D as V,a as G,b as z,c as W,d as K,e as ee}from"./dialog-BDMnm7Fp.js";import{I as se}from"./input-L_-VHgZB.js";import{L as w}from"./label-Ch3Qpvdb.js";import"./index-BeHAPgjQ.js";import{T as De}from"./textarea-2ialuiXC.js";import{a as I}from"./api-BCiONhZ8.js";import{s as h}from"./toast-CBrN9sog.js";import{I as q}from"./IconFileText-CQlGGR13.js";import{C as js}from"./calendar-vegV-pg_.js";import{c as vs}from"./createReactComponent-CAvr32i6.js";import{C as X}from"./circle-check-Bn1A0iOv.js";import{C as Pe}from"./circle-x-CSWeUvJ8.js";import{C as ie}from"./clock-CjeLcntR.js";import{I as bs}from"./IconUsers-DGqKWc1T.js";import{I as Ns}from"./IconEye-Bw4jvepO.js";import{I as ks}from"./IconEdit-CcmCEER-.js";import{I as _s}from"./IconTrash-MfoBVftz.js";import{F as ys}from"./file-text-Cn-yV2BY.js";/* empty css            */import"./loader-circle-DS5R5jI-.js";import"./user-BJizuUvm.js";import"./tiny-invariant-CopsF_GD.js";import"./chevron-left-B3CqyqQr.js";import"./chevron-right-D5vTS9_Z.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]],Ae=vs("outline","send","Send",ws);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Cs=xs("CircleAlert",Ss);function Ds(r,o=[]){let d=[];function a(u,p){const c=i.createContext(p);c.displayName=u+"Context";const m=d.length;d=[...d,p];const v=N=>{const{scope:S,children:E,...k}=N,Y=S?.[r]?.[m]||c,re=i.useMemo(()=>k,Object.values(k));return e.jsx(Y.Provider,{value:re,children:E})};v.displayName=u+"Provider";function _(N,S){const E=S?.[r]?.[m]||c,k=i.useContext(E);if(k)return k;if(p!==void 0)return p;throw new Error(`\`${N}\` must be used within \`${u}\``)}return[v,_]}const l=()=>{const u=d.map(p=>i.createContext(p));return function(c){const m=c?.[r]||u;return i.useMemo(()=>({[`__scope${r}`]:{...c,[r]:m}}),[c,m])}};return l.scopeName=r,[a,Ps(l,...o)]}function Ps(...r){const o=r[0];if(r.length===1)return o;const d=()=>{const a=r.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(u){const p=a.reduce((c,{useScope:m,scopeName:v})=>{const N=m(u)[`__scope${v}`];return{...c,...N}},{});return i.useMemo(()=>({[`__scope${o.scopeName}`]:p}),[p])}};return d.scopeName=o.scopeName,d}var As=Symbol.for("react.lazy"),ae=is[" use ".trim().toString()];function $s(r){return typeof r=="object"&&r!==null&&"then"in r}function Ee(r){return r!=null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===As&&"_payload"in r&&$s(r._payload)}function Is(r){const o=Es(r),d=i.forwardRef((a,l)=>{let{children:u,...p}=a;Ee(u)&&typeof ae=="function"&&(u=ae(u._payload));const c=i.Children.toArray(u),m=c.find(Fs);if(m){const v=m.props.children,_=c.map(N=>N===m?i.Children.count(v)>1?i.Children.only(null):i.isValidElement(v)?v.props.children:null:N);return e.jsx(o,{...p,ref:l,children:i.isValidElement(v)?i.cloneElement(v,void 0,_):null})}return e.jsx(o,{...p,ref:l,children:u})});return d.displayName=`${r}.Slot`,d}function Es(r){const o=i.forwardRef((d,a)=>{let{children:l,...u}=d;if(Ee(l)&&typeof ae=="function"&&(l=ae(l._payload)),i.isValidElement(l)){const p=Ms(l),c=Os(u,l.props);return l.type!==i.Fragment&&(c.ref=a?fs(a,p):p),i.cloneElement(l,c)}return i.Children.count(l)>1?i.Children.only(null):null});return o.displayName=`${r}.SlotClone`,o}var Rs=Symbol("radix.slottable");function Fs(r){return i.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Rs}function Os(r,o){const d={...o};for(const a in o){const l=r[a],u=o[a];/^on[A-Z]/.test(a)?l&&u?d[a]=(...c)=>{const m=u(...c);return l(...c),m}:l&&(d[a]=l):a==="style"?d[a]={...l,...u}:a==="className"&&(d[a]=[l,u].filter(Boolean).join(" "))}return{...r,...d}}function Ms(r){let o=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,d=o&&"isReactWarning"in o&&o.isReactWarning;return d?r.ref:(o=Object.getOwnPropertyDescriptor(r,"ref")?.get,d=o&&"isReactWarning"in o&&o.isReactWarning,d?r.props.ref:r.props.ref||r.ref)}var Ts=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Re=Ts.reduce((r,o)=>{const d=Is(`Primitive.${o}`),a=i.forwardRef((l,u)=>{const{asChild:p,...c}=l,m=p?d:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...c,ref:u})});return a.displayName=`Primitive.${o}`,{...r,[o]:a}},{}),de="Progress",ce=100,[Us,Ca]=Ds(de),[Bs,Ls]=Us(de),Fe=i.forwardRef((r,o)=>{const{__scopeProgress:d,value:a=null,max:l,getValueLabel:u=Hs,...p}=r;(l||l===0)&&!$e(l)&&console.error(Vs(`${l}`,"Progress"));const c=$e(l)?l:ce;a!==null&&!Ie(a,c)&&console.error(Gs(`${a}`,"Progress"));const m=Ie(a,c)?a:null,v=te(m)?u(m,c):void 0;return e.jsx(Bs,{scope:d,value:m,max:c,children:e.jsx(Re.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":te(m)?m:void 0,"aria-valuetext":v,role:"progressbar","data-state":Te(m,c),"data-value":m??void 0,"data-max":c,...p,ref:o})})});Fe.displayName=de;var Oe="ProgressIndicator",Me=i.forwardRef((r,o)=>{const{__scopeProgress:d,...a}=r,l=Ls(Oe,d);return e.jsx(Re.div,{"data-state":Te(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...a,ref:o})});Me.displayName=Oe;function Hs(r,o){return`${Math.round(r/o*100)}%`}function Te(r,o){return r==null?"indeterminate":r===o?"complete":"loading"}function te(r){return typeof r=="number"}function $e(r){return te(r)&&!isNaN(r)&&r>0}function Ie(r,o){return te(r)&&!isNaN(r)&&r<=o&&r>=0}function Vs(r,o){return`Invalid prop \`max\` of value \`${r}\` supplied to \`${o}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ce}\`.`}function Gs(r,o){return`Invalid prop \`value\` of value \`${r}\` supplied to \`${o}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ce} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ue=Fe,zs=Me;const Be=i.forwardRef(({className:r,value:o,...d},a)=>e.jsx(Ue,{ref:a,className:gs("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...d,children:e.jsx(zs,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(o||0)}%)`}})}));Be.displayName=Ue.displayName;function Da({dokumen:r}){const o=ds().props,{auth:d}=o;if(!r||!r.id)return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:"Dokumen Not Found"}),e.jsxs(_e,{children:[e.jsx(ye,{}),e.jsx(we,{variant:"inset"}),e.jsxs(Se,{children:[e.jsx(Ce,{}),e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dokumen Tidak Ditemukan"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Data dokumen tidak tersedia"}),e.jsx(j,{className:"mt-4",onClick:()=>L.visit("/user/dokumen"),children:"Kembali ke Daftar Dokumen"})]})})]})]})]});const[a,l]=i.useState(r),[u,p]=i.useState(!1),[c,m]=i.useState(!1),[v,_]=i.useState(!1),[N,S]=i.useState(!1),[E,k]=i.useState(!1),[Y,re]=i.useState(""),[me,Le]=i.useState(""),[R,ne]=i.useState(null),[oe,ue]=i.useState(""),[pe,xe]=i.useState(!1),[Ws,He]=i.useState([]),[Ks,fe]=i.useState(null),[qs,Ve]=i.useState({}),[y,F]=i.useState({nomor_dokumen:a?.nomor_dokumen||"",judul_dokumen:a?.judul_dokumen||"",masterflow_id:a?.masterflow_id||"",tgl_pengajuan:a?.tgl_pengajuan||"",tgl_deadline:a?.tgl_deadline||"",deskripsi:a?.deskripsi||"",file:null,approvers:{},custom_approvers:[]}),[O,M]=i.useState(!1),[T,J]=i.useState({});i.useEffect(()=>{console.log("Dokumen data:",a),console.log("Initial dokumen:",r),console.log("Dokumen ID:",a?.id),console.log("All props:",o)},[]);const ge=async()=>{try{const s=await I.get(`/dokumen/${a.id}`);return console.log("Fetched dokumen:",s.data),s.data&&s.data.id?(l(s.data),s.data):(console.warn("Invalid dokumen data received:",s.data),null)}catch(s){return console.error("Error fetching dokumen:",s),null}},Ge=async()=>{try{const s=await I.get("/masterflows");He(s.data.masterflows||[])}catch(s){console.error("Error fetching masterflows:",s)}};i.useEffect(()=>{if(Ge(),typeof window<"u"&&window.Echo&&a.id){console.log("ðŸ“¡ Setting up real-time listener for dokumen:",a.id);const s=`dokumen.${a.id}`;return window.Echo.channel(s).listen("dokumen.updated",t=>{console.log("ðŸ“¡ Real-time update received:",t),t.dokumen&&t.dokumen.id===a.id&&(l(t.dokumen),h.success("ðŸ“¡ Dokumen telah diupdate secara real-time!"))}),()=>{console.log("ðŸ”Œ Leaving channel:",s),window.Echo.leave(s)}}},[a.id]);const U=(()=>{if(!a.approvals||a.approvals.length===0)return{percentage:0,approved:0,total:0,pending:0,rejected:0};const s=a.approvals.length,t=a.approvals.filter(f=>f.approval_status==="approved"||f.approval_status==="skipped").length,n=a.approvals.filter(f=>f.approval_status==="pending").length,x=a.approvals.filter(f=>f.approval_status==="rejected").length;return{percentage:t/s*100,approved:t,total:s,pending:n,rejected:x}})(),Z=!a.masterflow_id,ze=s=>{const t={draft:{label:"Draft",icon:ys,className:"bg-gray-100 text-gray-800 border-gray-300"},pending:{label:"Pending",icon:ie,className:"bg-yellow-100 text-yellow-800 border-yellow-300"},submitted:{label:"Submitted",icon:X,className:"bg-blue-100 text-blue-800 border-blue-300"},under_review:{label:"Under Review",icon:Cs,className:"bg-orange-100 text-orange-800 border-orange-300"},approved:{label:"Approved",icon:X,className:"bg-green-100 text-green-800 border-green-300"},rejected:{label:"Rejected",icon:Pe,className:"bg-red-100 text-red-800 border-red-300"}},n=t[s]||t.draft,x=n.icon;return e.jsxs(H,{variant:"outline",className:`font-sans ${n.className}`,children:[e.jsx(x,{className:"mr-1 h-3 w-3"}),n.label]})},he=s=>{const t={pending:{label:"Menunggu",className:"bg-yellow-100 text-yellow-800 border-yellow-300"},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 border-green-300"},skipped:{label:"Disetujui",className:"bg-green-100 text-green-800 border-green-300"},rejected:{label:"Ditolak",className:"bg-red-100 text-red-800 border-red-300"},waiting:{label:"Menunggu Giliran",className:"bg-gray-100 text-gray-800 border-gray-300"}},n=t[s]||t.pending;return e.jsx(H,{variant:"outline",className:`font-sans ${n.className}`,children:n.label})},We=s=>{if(s===0)return"0 Bytes";const t=1024,n=["Bytes","KB","MB","GB"],x=Math.floor(Math.log(s)/Math.log(t));return Math.round(s/Math.pow(t,x)*100)/100+" "+n[x]},B=s=>{if(!s)return"-";try{const t=new Date(s);return isNaN(t.getTime())?"-":t.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"})}catch{return"-"}},Ke=()=>{if(a.status!=="draft"&&a.status!=="rejected"){h.error("âŒ Hanya dokumen dengan status Draft atau Rejected yang dapat diedit.");return}if(F({nomor_dokumen:a.nomor_dokumen,judul_dokumen:a.judul_dokumen,masterflow_id:a.masterflow_id||"",tgl_pengajuan:a.tgl_pengajuan,tgl_deadline:a.tgl_deadline||"",deskripsi:a.deskripsi||"",file:null,approvers:{},custom_approvers:[]}),a.masterflow_id&&a.masterflow)fe(a.masterflow),qe(a.masterflow_id);else if(Z&&a.approvals){const s=a.approvals.map(t=>({email:t.approver_email||"",order:t.approval_order||1}));F(t=>({...t,masterflow_id:"custom",custom_approvers:s}))}p(!0)},qe=async s=>{try{const t=await I.get(`/masterflows/${s}/steps`),n={...a.masterflow,steps:t.data.steps||[]};fe(n);const x={};for(const b of t.data.steps||[])if(b.jabatan_id)try{const f=await I.get(`/users-by-jabatan/${b.jabatan_id}`);x[b.id]=f.data||[]}catch(f){console.error(`Error fetching users for jabatan ${b.jabatan_id}:`,f),x[b.id]=[]}if(Ve(x),a.approvals){const b={};a.approvals.forEach(f=>{f.masterflow_step_id&&f.user_id&&(b[f.masterflow_step_id]=f.user_id)}),F(f=>({...f,approvers:b}))}}catch(t){console.error("Error fetching approvers:",t)}},le=s=>{const{name:t,value:n}=s.target;F(x=>({...x,[t]:n})),T[t]&&J(x=>({...x,[t]:[]}))},Xe=s=>{s.target.files&&s.target.files[0]&&(F(t=>({...t,file:s.target.files[0]})),T.file&&J(t=>({...t,file:[]})))},Ye=async s=>{s.preventDefault(),M(!0),J({});try{const t=new FormData;t.append("_method","PUT"),t.append("judul_dokumen",y.judul_dokumen),t.append("deskripsi",y.deskripsi),y.tgl_deadline&&t.append("tgl_deadline",y.tgl_deadline),y.file&&t.append("file",y.file),L.post(`/dokumen/${a.id}`,t,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h.success("ðŸŽ‰ Dokumen berhasil diupdate!"),p(!1),ge()},onError:n=>{console.error("Form submission errors:",n),J(n),h.error("âŒ Gagal update dokumen. Silakan cek form.")}})}catch(t){console.error("Form submission error:",t),h.error(`âŒ Gagal update dokumen. ${t.response?.data?.message||t.message}`)}finally{M(!1)}},Je=()=>{if(a.status!=="draft"){h.error("âŒ Hanya dokumen dengan status Draft yang dapat dihapus.");return}m(!0)},Ze=async()=>{try{await I.delete(`/dokumen/${a.id}`),h.success("ðŸŽ‰ Dokumen berhasil dihapus!"),L.visit("/user/dokumen")}catch(s){h.error(`âŒ Gagal menghapus dokumen. ${s.response?.data?.message||s.message}`)}},Qe=s=>{const t=`/api/dokumen/${a.id}/signed-pdf/${s.id}`,n=s.tipe_file.toLowerCase();if(!(n==="pdf"||n==="application/pdf")){h.error("âŒ Preview hanya tersedia untuk file PDF.");return}re(t),Le(s.nama_file),S(!0)},je=()=>{if(a.status!=="draft"){h.error("âŒ Hanya dokumen draft yang dapat disubmit.");return}_(!0)},es=async()=>{M(!0),L.post(`/dokumen/${a.id}/submit`,{},{preserveState:!1,preserveScroll:!0,onSuccess:()=>{h.success("ðŸŽ‰ Dokumen berhasil disubmit untuk approval!"),_(!1),M(!1)},onError:s=>{console.error("Submit error:",s),h.error(`âŒ Gagal submit dokumen. ${s.error||"Silakan coba lagi."}`),M(!1)}})},ve=()=>{if(a.status!=="rejected"){h.error("âŒ Hanya dokumen yang di-reject yang dapat direvisi.");return}if(a.user_id!==d.user.id){h.error("âŒ Hanya pemilik dokumen yang dapat mengupload revisi.");return}ne(null),ue(""),k(!0)},ss=s=>{const t=s.target.files?.[0]||null;if(t){if(t.size>52428800){h.error("âŒ Ukuran file maksimal 50MB");return}if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){h.error("âŒ Format file harus PDF atau Word");return}}ne(t)},as=async()=>{if(!R){h.error("âŒ Silakan pilih file revisi terlebih dahulu.");return}xe(!0);try{const s=new FormData;s.append("file",R),oe&&s.append("comment",oe);const t=await I.post(`/dokumen/${a.id}/upload-revision`,s,{headers:{"Content-Type":"multipart/form-data"}}),n=t.data?.message||"ðŸŽ‰ Revisi dokumen berhasil diupload!";h.success(n),k(!1),ne(null),t.data?.dokumen?l(t.data.dokumen):await ge()}catch(s){console.error("Upload revision error:",s),h.error(`âŒ Gagal upload revisi. ${s.response?.data?.message||s.message}`)}finally{xe(!1)}},ts=s=>{const t=s?`/api/dokumen/${a.id}/download/${s}`:`/api/dokumen/${a.id}/download`;window.location.href=t},rs=[...a.approvals||[]].sort((s,t)=>s.approval_order!==void 0&&t.approval_order!==void 0?s.approval_order-t.approval_order:s.masterflow_step&&t.masterflow_step?s.masterflow_step.step_order-t.masterflow_step.step_order:0),C={},be=[];rs.forEach(s=>{const t=s.masterflow_step?.step_order??s.approval_order??0;s.group_index?(C[s.group_index]||(C[s.group_index]={approvals:[],firstStepOrder:t,groupType:s.jenis_group||"parallel"}),C[s.group_index].approvals.push(s),t<C[s.group_index].firstStepOrder&&(C[s.group_index].firstStepOrder=t)):be.push({approval:s,stepOrder:t})});const Ne=[],Q=[];Object.entries(C).forEach(([s,t])=>{Q.push({item:{type:"group",data:t.approvals,groupIndex:s,groupType:t.groupType,firstStepOrder:t.firstStepOrder},stepOrder:t.firstStepOrder})}),be.forEach(({approval:s,stepOrder:t})=>{Q.push({item:{type:"single",data:s},stepOrder:t})}),Q.sort((s,t)=>s.stepOrder-t.stepOrder),Q.forEach(({item:s})=>Ne.push(s));const ns=s=>{switch(s){case"any_one":return"Salah Satu Setuju";case"all_required":return"Semua Harus Setuju";case"majority":return"Mayoritas Setuju";default:return"Harus Setuju"}};return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:a?.judul_dokumen||"Detail Dokumen"}),e.jsxs(_e,{children:[e.jsx(ye,{}),e.jsx(we,{variant:"inset"}),e.jsxs(Se,{children:[e.jsx(Ce,{}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(j,{variant:"link",className:"h-auto p-0 text-muted-foreground",onClick:()=>L.visit("/user/dokumen"),children:"Dokumen Saya"}),e.jsx("span",{children:"/"}),e.jsx("span",{children:"Detail"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"font-serif text-3xl font-bold tracking-tight text-foreground",children:a?.judul_dokumen}),ze(a?.status||"draft")]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"font-mono",children:a?.nomor_dokumen||"-"})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{children:B(a?.tgl_pengajuan)})]})]})]}),e.jsxs("div",{className:"hidden items-center gap-2 sm:flex",children:[a?.status==="draft"&&e.jsxs(j,{onClick:je,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Submit Approval"]}),a?.status==="rejected"&&a?.user_id===d.user.id&&e.jsxs(j,{onClick:ve,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Upload Revisi"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(A,{className:"font-serif text-lg",children:"Informasi Dokumen"})}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Masterflow"}),e.jsx("div",{className:"font-medium",children:Z?e.jsxs("span",{className:"flex items-center gap-2 text-primary",children:[e.jsx("span",{children:"âœ¨"})," Custom Approval"]}):a.masterflow?.name||"-"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Deadline"}),e.jsx("div",{className:"font-medium",children:a.tgl_deadline?B(a.tgl_deadline):"-"})]})]}),a.deskripsi&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Deskripsi"}),e.jsx("div",{className:"rounded-md bg-muted/30 p-4 text-sm leading-relaxed text-foreground",children:a.deskripsi})]})]})]}),e.jsxs(D,{children:[e.jsxs(P,{children:[e.jsx(A,{className:"font-serif text-lg",children:"Timeline Persetujuan"}),e.jsx(hs,{children:"Proses approval dokumen ini"})]}),e.jsx($,{children:e.jsxs("div",{className:"relative space-y-0 pl-2",children:[e.jsx("div",{className:"absolute top-2 bottom-6 left-6 w-0.5 bg-border"}),Ne.map((s,t)=>{if(s.type==="single"){const n=s.data,x=n.approval_status==="approved"||n.approval_status==="skipped",b=n.approval_status==="rejected",f=n.approval_status==="pending";return e.jsxs("div",{className:"relative flex gap-4 pb-8 last:pb-0",children:[e.jsx("div",{className:`relative z-10 flex h-8 w-8 shrink-0 items-center justify-center rounded-full border-2 bg-background ${x?"border-green-600 text-green-600":b?"border-red-600 text-red-600":f?"border-yellow-500 text-yellow-500":"border-muted text-muted-foreground"}`,children:x?e.jsx(X,{className:"h-4 w-4"}):b?e.jsx(Pe,{className:"h-4 w-4"}):e.jsx("span",{className:"text-xs font-bold",children:t+1})}),e.jsxs("div",{className:"flex-1 space-y-1.5 pt-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:Z?n.approver_email||"Unknown User":n.user?.name||n.masterflow_step?.jabatan?.name||"Unknown Position"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:Z?`Order: ${n.approval_order}`:n.masterflow_step?.step_name||"Approval Step"})]}),he(n.approval_status)]}),(n.comment||n.alasan_reject)&&e.jsxs("div",{className:"mt-2 rounded-md bg-muted/40 p-3 text-sm",children:[n.alasan_reject&&e.jsxs("div",{className:"mb-1 font-medium text-red-600",children:["Alasan: ",n.alasan_reject]}),n.comment&&e.jsxs("div",{className:"text-muted-foreground italic",children:['"',n.comment,'"']})]}),n.tgl_approve&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ie,{className:"h-3 w-3"}),B(n.tgl_approve)]})]})]},n.id)}else{const n=s,x=n.data.every(g=>g.approval_status==="approved"||g.approval_status==="skipped"),b=n.data.some(g=>g.approval_status==="rejected"),f=n.data.some(g=>g.approval_status==="approved"),os=(n.groupType==="any_one"?f:x)?"border-green-600 text-green-600":b?"border-red-600 text-red-600":"border-yellow-500 text-yellow-500";return e.jsxs("div",{className:"relative flex gap-4 pb-8 last:pb-0",children:[e.jsx("div",{className:`relative z-10 flex h-8 w-8 shrink-0 items-center justify-center rounded-full border-2 bg-background ${os}`,children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1 pt-1",children:e.jsxs("div",{className:"mb-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between border-b bg-muted/20 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:n.data[0]?.masterflow_step?.step_name||"Group Approval"}),e.jsx(H,{variant:"outline",className:"h-5 px-1.5 text-[10px] tracking-wide uppercase",children:ns(n.groupType)})]})}),e.jsx("div",{className:"divide-y p-0",children:n.data.map(g=>{const ls=g.approval_status==="skipped";return e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:g.user?.name||g.masterflow_step?.jabatan?.name||"Unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g.masterflow_step?.jabatan?.name})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[he(g.approval_status),g.tgl_approve&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:B(g.tgl_approve)})]})]}),ls&&e.jsx("div",{className:"mt-1 text-[10px] text-muted-foreground italic",children:"*Otomatis di-skip karena grup sudah menyelesaikan approval."}),(g.comment||g.alasan_reject)&&e.jsxs("div",{className:"mt-2 rounded bg-muted/40 p-2 text-xs",children:[g.alasan_reject&&e.jsxs("div",{className:"font-medium text-red-600",children:["Alasan Penolakan: ",g.alasan_reject]}),g.comment&&e.jsxs("div",{className:"text-muted-foreground",children:['Komentar: "',g.comment,'"']})]})]},g.id)})})]})})]},`group-${n.groupIndex}`)}})]})})]}),a.versions&&a.versions.length>0&&e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(A,{className:"font-serif text-lg",children:"Riwayat Versi"})}),e.jsx($,{children:e.jsx("div",{className:"divide-y rounded-md border",children:a.versions.sort((s,t)=>new Date(t.tgl_upload).getTime()-new Date(s.tgl_upload).getTime()).map((s,t)=>{const n=t===0;return e.jsxs("div",{className:`flex items-center justify-between p-4 ${n?"bg-blue-50/30":"hover:bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex h-10 w-10 shrink-0 items-center justify-center rounded-lg border ${n?"border-blue-200 bg-blue-100 text-blue-700":"bg-background text-muted-foreground"}`,children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Versi ",s.version]}),n&&e.jsx(H,{variant:"secondary",className:"bg-blue-100 text-blue-700 hover:bg-blue-100",children:"Latest"}),s.signed_file_url&&e.jsxs(H,{variant:"outline",className:"gap-1 border-green-200 bg-green-50 text-green-700 hover:bg-green-50",children:[e.jsx(X,{className:"h-3 w-3"}),"Signed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.nama_file}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:We(s.size_file)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:B(s.tgl_upload)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[(s.tipe_file.toLowerCase()==="pdf"||s.tipe_file.toLowerCase()==="application/pdf")&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Qe(s),children:e.jsx(Ns,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>ts(s.id),children:e.jsx(us,{className:"h-4 w-4"})})]})]},s.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[a?.detailed_status?.current_step_description&&!a?.detailed_status?.is_fully_approved&&!a?.detailed_status?.is_rejected&&e.jsxs(D,{className:"border-blue-200 bg-blue-50 shadow-sm",children:[e.jsx(P,{className:"pb-3",children:e.jsxs(A,{className:"flex items-center gap-2 text-base text-blue-900",children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-blue-200",children:e.jsx(ie,{className:"h-3.5 w-3.5 text-blue-700"})}),"Status Saat Ini"]})}),e.jsxs($,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm leading-relaxed font-medium text-blue-800",children:a.detailed_status.current_step_description}),a.detailed_status.next_approvers&&a.detailed_status.next_approvers.length>0&&e.jsxs("div",{className:"space-y-2 rounded-md bg-white/60 p-3",children:[e.jsx("p",{className:"text-xs font-semibold tracking-wide text-blue-700 uppercase",children:"Menunggu Response:"}),e.jsx("div",{className:"space-y-2",children:a.detailed_status.next_approvers.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-6 w-6 border border-white shadow-sm",children:e.jsx(ms,{className:"bg-blue-100 text-[10px] text-blue-700",children:s.user?.name?.substring(0,2).toUpperCase()||"??"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-foreground",children:s.user?.name||s.approver_email}),s.jabatan_name&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.jabatan_name})]})]},t))})]})]})]}),e.jsxs(D,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(A,{className:"text-base font-medium",children:"Statistik Approval"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Progress"}),e.jsxs("span",{className:"font-medium",children:[Math.round(U.percentage),"%"]})]}),e.jsx(Be,{value:U.percentage,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"rounded-md border bg-muted/20 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:U.approved}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Approved"})]}),e.jsxs("div",{className:"rounded-md border bg-muted/20 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:U.pending}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"rounded-md border bg-muted/20 p-2",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:U.rejected}),e.jsx("div",{className:"text-[10px] text-muted-foreground",children:"Rejected"})]})]})]})]}),(a?.status==="draft"||a?.status==="rejected")&&e.jsxs(D,{children:[e.jsx(P,{className:"pb-3",children:e.jsx(A,{className:"text-base font-medium",children:"Kelola Dokumen"})}),e.jsxs($,{className:"space-y-2",children:[a?.status==="draft"&&e.jsxs(j,{onClick:je,className:"w-full justify-start bg-green-600 hover:bg-green-700",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Submit Approval"]}),a?.status==="rejected"&&a?.user_id===d.user.id&&e.jsxs(j,{onClick:ve,className:"w-full justify-start bg-blue-600 hover:bg-blue-700",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Upload Revisi"]}),e.jsxs(j,{variant:"outline",onClick:Ke,className:"w-full justify-start",children:[e.jsx(ks,{className:"mr-2 h-4 w-4"}),"Edit Informasi"]}),e.jsxs(j,{variant:"outline",onClick:Je,className:"w-full justify-start text-red-600 hover:bg-red-50 hover:text-red-700",children:[e.jsx(_s,{className:"mr-2 h-4 w-4"}),"Hapus Dokumen"]})]})]})]})]})]}),e.jsx(V,{open:u,onOpenChange:p,children:e.jsx(G,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[600px]",children:e.jsxs("form",{onSubmit:Ye,children:[e.jsxs(z,{children:[e.jsx(W,{className:"font-serif",children:"Edit Dokumen"}),e.jsx(K,{className:"font-sans",children:"Ubah informasi dokumen Anda di sini."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(w,{htmlFor:"judul_dokumen",className:"font-sans",children:["Judul Dokumen ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(se,{id:"judul_dokumen",name:"judul_dokumen",value:y.judul_dokumen,onChange:le,className:T.judul_dokumen?"border-red-500 font-sans":"font-sans"}),T.judul_dokumen&&e.jsx("p",{className:"text-sm text-red-500",children:T.judul_dokumen[0]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"tgl_deadline",className:"font-sans",children:"Deadline"}),e.jsx(se,{id:"tgl_deadline",name:"tgl_deadline",type:"date",value:y.tgl_deadline,onChange:le,className:"font-sans"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"deskripsi",className:"font-sans",children:"Deskripsi"}),e.jsx(De,{id:"deskripsi",name:"deskripsi",value:y.deskripsi,onChange:le,className:"font-sans",rows:4})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"file",className:"font-sans",children:"Upload File Baru (Opsional)"}),e.jsx(se,{id:"file",name:"file",type:"file",onChange:Xe,className:"font-sans",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Kosongkan jika tidak ingin mengganti file. Max 10MB."})]})]}),e.jsxs(ee,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:O,className:"font-sans",children:"Batal"}),e.jsx(j,{type:"submit",disabled:O,className:"font-sans",children:O?"Menyimpan...":"Simpan Perubahan"})]})]})})}),e.jsx(V,{open:c,onOpenChange:m,children:e.jsxs(G,{children:[e.jsxs(z,{children:[e.jsx(W,{className:"font-serif",children:"Hapus Dokumen"}),e.jsxs(K,{className:"font-sans",children:['Apakah Anda yakin ingin menghapus dokumen "',e.jsx("strong",{children:a.judul_dokumen}),'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(ee,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>m(!1),className:"font-sans",children:"Batal"}),e.jsx(j,{type:"button",variant:"destructive",onClick:Ze,className:"font-sans",children:"Hapus"})]})]})}),e.jsx(V,{open:v,onOpenChange:_,children:e.jsxs(G,{children:[e.jsxs(z,{children:[e.jsx(W,{className:"font-serif",children:"Submit untuk Approval"}),e.jsxs(K,{className:"font-sans",children:['Apakah Anda yakin ingin mengirim dokumen "',e.jsx("strong",{children:a.judul_dokumen}),'" untuk approval?',e.jsx("br",{}),e.jsx("br",{}),"Setelah disubmit, dokumen akan masuk ke proses approval dan tidak dapat diedit kecuali ditolak."]})]}),e.jsxs(ee,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>_(!1),className:"font-sans",children:"Batal"}),e.jsxs(j,{type:"button",className:"bg-green-600 font-sans hover:bg-green-700",onClick:es,disabled:O,children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),O?"Mengirim...":"Ya, Submit Sekarang"]})]})]})}),e.jsx(V,{open:E,onOpenChange:k,children:e.jsxs(G,{className:"max-w-md",children:[e.jsxs(z,{children:[e.jsx(W,{className:"font-serif",children:"Upload Revisi Dokumen"}),e.jsxs(K,{className:"font-sans",children:['Upload versi terbaru dokumen "',e.jsx("strong",{children:a.judul_dokumen}),'".',e.jsx("br",{}),e.jsx("br",{}),'Setelah upload, dokumen akan direset ke status "Under Review" dan approval akan dimulai dari awal dengan versi baru.']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"revision-file",className:"font-sans",children:"File Revisi *"}),e.jsx(se,{id:"revision-file",type:"file",accept:".pdf,.doc,.docx",onChange:ss,className:"font-sans"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: PDF atau Word. Maksimal 50MB."}),R&&e.jsxs("p",{className:"text-sm text-green-600",children:["âœ“ File dipilih: ",R.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"revision-comment",className:"font-sans",children:"Catatan Revisi (Opsional)"}),e.jsx(De,{id:"revision-comment",placeholder:"Jelaskan perubahan yang dilakukan...",value:oe,onChange:s=>ue(s.target.value),className:"font-sans",rows:3})]})]}),e.jsxs(ee,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>k(!1),className:"font-sans",children:"Batal"}),e.jsxs(j,{type:"button",className:"bg-blue-600 font-sans hover:bg-blue-700",onClick:as,disabled:pe||!R,children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),pe?"Mengupload...":"Upload Revisi"]})]})]})}),e.jsx(V,{open:N,onOpenChange:S,children:e.jsxs(G,{className:"flex h-[90vh] max-w-[90vw] flex-col p-0",children:[e.jsxs(z,{className:"shrink-0 border-b p-4",children:[e.jsx(W,{className:"font-serif",children:"Preview Dokumen"}),e.jsx(K,{className:"font-sans",children:me})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:Y&&e.jsx(ps,{fileUrl:Y,fileName:me,showControls:!0,height:"100%"})})]})})]})]})]})}export{Da as default};
