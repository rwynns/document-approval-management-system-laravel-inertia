import{u as je,r as n,j as e,H as ge}from"./app-CNJch6fJ.js";import{S as Ne,N as be,A as ve,a as ye,B as we,U as _e,V as Se}from"./NotificationListener-CHbz9J81.js";import{S as ke}from"./site-header-1ZLAZI7i.js";import{a as Ce,B as i}from"./button-Bc8fY39k.js";import{C as Pe,d as Fe}from"./card-BdiGcNVe.js";import{D as Ue,a as Ae,b as Re,c as Te,d as Me,e as De}from"./dialog-BDMnm7Fp.js";import{I as F}from"./input-L_-VHgZB.js";import{L as o}from"./label-Ch3Qpvdb.js";import{S as f,a as j,b as g,c as N,d as c}from"./select-DahuNLv9.js";import{T as Ee,a as ze,b as J,c as _,d as Ie,e as b}from"./table-dbNKOOTV.js";import{T as Le}from"./textarea-2ialuiXC.js";import{a as x}from"./api-BCiONhZ8.js";import{s as p}from"./toast-CBrN9sog.js";import{I as $e}from"./IconUser-CFX-ui2T.js";import{A as Be}from"./activity-5R1ujG4d.js";import{I as Je}from"./IconPlus-DwaGKv2n.js";import{S as Ve}from"./smartphone-CnowCJ8W.js";import{S as He}from"./square-pen-D3BDszsU.js";import{T as Oe}from"./trash-2-CT4TwgH7.js";import{C as qe,a as Ke}from"./chevrons-right-oR8HuQnT.js";import{C as Ge}from"./chevron-left-B3CqyqQr.js";import{C as Qe}from"./chevron-right-D5vTS9_Z.js";import{E as Y}from"./eye-off-CbuoMVLP.js";import{E as Z}from"./eye-D7yVw-EQ.js";import{P as We}from"./plus-BJQlIx4e.js";/* empty css            */import"./index-BeHAPgjQ.js";import"./loader-circle-DS5R5jI-.js";import"./file-text-Cn-yV2BY.js";import"./user-BJizuUvm.js";import"./createReactComponent-CAvr32i6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ye=Ce("Minus",Xe),ee={name:"",email:"",password:"",pin:"",address:"",phone_number:"",user_auths:[{role_id:"",company_id:"",jabatan_id:"",aplikasi_id:""}]};function Us(){const{auth:U}=je().props,[D,se]=n.useState([]),[A,V]=n.useState([]),[E,H]=n.useState([]),[R,O]=n.useState([]),[z,q]=n.useState([]),[K,G]=n.useState(!0),[ae,S]=n.useState(!1),[u,Q]=n.useState(null),[d,v]=n.useState(ee),[I,W]=n.useState(!1),[L,te]=n.useState(!1),[$,ne]=n.useState(!1),[r,k]=n.useState({}),[C,re]=n.useState(""),[P,le]=n.useState(""),[m,ie]=n.useState({current_page:1,per_page:10,total:0,last_page:1,from:0,to:0}),[h,y]=n.useState(1),[T,oe]=n.useState(10),B=async()=>{try{console.log("Fetching users..."),G(!0);const s=new URLSearchParams;C&&s.append("role_id",C),P&&s.append("jabatan_id",P),s.append("page",h.toString()),s.append("per_page",T.toString());const t=s.toString(),a=t?`/users?${t}`:"/users",l=await x.get(a);console.log("Users fetched:",l.data),se(l.data.data),ie(l.data.meta)}catch(s){console.error("Error fetching users:",s),p.error("âŒ Failed to load users. Please try again.")}finally{G(!1)}},ce=async()=>{try{console.log("Fetching master data...");const[s,t,a,l]=await Promise.all([x.get("/roles"),x.get("/companies"),x.get("/jabatans"),x.get("/aplikasis")]);console.log("Master data fetched:",{roles:s.data?.roles?.length||0,companies:t.data?.companies?.length||0,jabatans:a.data?.jabatans?.length||0,aplikasis:l.data?.aplikasis?.length||0}),V(s.data?.roles||[]),H(t.data?.companies||[]),O(a.data?.jabatans||[]),q(l.data?.aplikasis||[])}catch(s){console.error("Error fetching master data:",s),p.error("âŒ Failed to load master data. Please try again."),V([]),H([]),O([]),q([])}};n.useEffect(()=>{if(!U.user){console.log("No authenticated user found, redirecting to home"),p.error("âŒ Please login first to access User Management."),window.location.href="/";return}console.log("Authenticated user found, loading data"),ce()},[U.user]),n.useEffect(()=>{U.user&&B()},[U.user,C,P,h,T]),n.useEffect(()=>{y(1)},[C,P,T]);const w=s=>{const{name:t,value:a}=s.target;v(l=>({...l,[t]:a})),r[t]&&k(l=>({...l,[t]:[]}))},M=(s,t,a)=>{v(l=>({...l,user_auths:l.user_auths.map((X,fe)=>fe===s?{...X,[t]:a===""?"":Number(a)}:X)}))},de=()=>{v(s=>({...s,user_auths:[...s.user_auths,{role_id:"",company_id:"",jabatan_id:"",aplikasi_id:""}]}))},me=s=>{d.user_auths.length>1&&v(t=>({...t,user_auths:t.user_auths.filter((a,l)=>l!==s)}))},he=async()=>{try{await fetch("/sanctum/csrf-cookie",{credentials:"include"})}catch(s){console.warn("Failed to refresh CSRF token:",s)}Q(null),v(ee),k({}),S(!0)},pe=async s=>{try{await fetch("/sanctum/csrf-cookie",{credentials:"include"})}catch(t){console.warn("Failed to refresh CSRF token:",t)}Q(s),v({name:s.name,email:s.email,password:"",pin:s.pin,address:s.profile?.address||"",phone_number:s.profile?.phone_number||"",user_auths:s.user_auths&&s.user_auths.length>0?s.user_auths.map(t=>({role_id:t.role_id,company_id:t.company_id,jabatan_id:t.jabatan_id,aplikasi_id:t.aplikasi_id})):[{role_id:"",company_id:"",jabatan_id:"",aplikasi_id:""}]}),k({}),S(!0)},xe=async s=>{s.preventDefault(),W(!0),k({});try{console.log("Refreshing CSRF token before form submission..."),await fetch("/sanctum/csrf-cookie",{credentials:"include"}),await new Promise(a=>setTimeout(a,100));const t={...d};u&&!t.password&&delete t.password,u?(await x.put(`/users/${u.id}`,t),p.success(`ðŸŽ‰ User "${d.name}" updated successfully!`)):(await x.post("/users",t),p.success(`ðŸŽ‰ User "${d.name}" created successfully!`)),S(!1),B()}catch(t){console.error("Form submission error:",t),t.response?.data?.errors&&k(t.response.data.errors),t.response?.status===419?p.error("âŒ Session expired. Please refresh the page and try again."):p.error(`âŒ Failed to save user. ${t.response?.data?.message||t.message}`)}finally{W(!1)}},ue=async s=>{if(confirm(`Are you sure you want to delete user "${s.name}"?`))try{await x.delete(`/users/${s.id}`),p.success(`ðŸŽ‰ User "${s.name}" deleted successfully!`),B()}catch(t){p.error(`âŒ Failed to delete user. ${t.response?.data?.message||t.message}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{title:"User Management"}),e.jsxs(Ne,{children:[e.jsx(be,{}),e.jsx(ve,{variant:"inset"}),e.jsxs(ye,{children:[e.jsx(ke,{}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsxs("div",{className:"@container/main flex flex-1 flex-col gap-2 p-6",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("h1",{className:"flex items-center gap-3 font-sans text-3xl font-bold tracking-tight text-foreground",children:[e.jsx($e,{className:"h-8 w-8 text-primary"}),"Master User Management"]}),e.jsx("p",{className:"font-sans text-base text-muted-foreground",children:"Kelola dan atur master user dalam sistem"})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(we,{variant:"outline",className:"border-primary/30 bg-primary/10 font-sans text-sm font-medium text-primary",children:[e.jsx(Be,{className:"mr-1 h-3 w-3"}),m.total," Users"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"filter-role",className:"font-sans text-sm font-medium",children:"Role:"}),e.jsxs(f,{value:C||"all",onValueChange:s=>re(s==="all"?"":s),children:[e.jsx(j,{id:"filter-role",className:"w-40 font-sans",children:e.jsx(g,{placeholder:"Semua Role"})}),e.jsxs(N,{children:[e.jsx(c,{value:"all",children:"Semua Role"}),A.map(s=>e.jsx(c,{value:s.id.toString(),children:s.role_name},s.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"filter-jabatan",className:"font-sans text-sm font-medium",children:"Jabatan:"}),e.jsxs(f,{value:P||"all",onValueChange:s=>le(s==="all"?"":s),children:[e.jsx(j,{id:"filter-jabatan",className:"w-40 font-sans",children:e.jsx(g,{placeholder:"Semua Jabatan"})}),e.jsxs(N,{children:[e.jsx(c,{value:"all",children:"Semua Jabatan"}),R.map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]})]})]}),e.jsxs(i,{onClick:he,className:"gap-2 font-sans font-medium",children:[e.jsx(Je,{className:"h-4 w-4"}),"Tambah User"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[K?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading data user..."})]})}):e.jsx(Pe,{className:"border-border bg-card",children:e.jsx(Fe,{className:"p-0",children:e.jsxs(Ee,{children:[e.jsx(ze,{children:e.jsxs(J,{children:[e.jsx(_,{className:"w-16 font-sans",children:"No"}),e.jsx(_,{className:"w-48 font-sans",children:"Nama"}),e.jsx(_,{className:"w-56 font-sans",children:"Email"}),e.jsx(_,{className:"w-32 font-sans",children:"Telepon"}),e.jsx(_,{className:"min-w-80 font-sans",children:"Authorization"}),e.jsx(_,{className:"w-24 text-right font-sans",children:"Aksi"})]})}),e.jsx(Ie,{children:D.length>0?D.map((s,t)=>e.jsxs(J,{children:[e.jsx(b,{className:"font-mono",children:t+1}),e.jsx(b,{className:"font-sans font-medium",children:s.name}),e.jsx(b,{className:"font-sans",children:s.email}),e.jsx(b,{className:"font-sans",children:s.profile?.phone_number||"-"}),e.jsx(b,{className:"font-sans",children:e.jsx("div",{className:"space-y-4",children:s.user_auths&&s.user_auths.length>0?s.user_auths.map((a,l)=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ${a.role?.role_name==="Super Admin"?"bg-red-100 text-red-800":a.role?.role_name==="Admin"?"bg-blue-100 text-blue-800":a.role?.role_name==="User"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.role?.role_name||"No Role"})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-700",children:[e.jsx(_e,{className:"h-3.5 w-3.5 text-gray-500"}),e.jsx("span",{className:"font-medium",children:a.company?.name||"No Company"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"h-3 w-3"}),e.jsx("span",{children:a.jabatan?.name||"No Jabatan"})]}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),e.jsx("span",{children:a.aplikasi?.name||"No Aplikasi"})]})]}),l<s.user_auths.length-1&&e.jsx("div",{className:"mt-3 border-t border-gray-200 pt-3"})]},l)):e.jsx("div",{className:"py-2 text-sm text-gray-500",children:"Tidak ada authorization"})})}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>pe(s),className:"h-8 w-8 border-blue-300 p-0 text-blue-600 hover:bg-blue-50",children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ue(s),className:"h-8 w-8 border-red-300 p-0 text-red-600 hover:bg-red-50",children:e.jsx(Oe,{className:"h-4 w-4"})})]})})]},s.id)):e.jsx(J,{children:e.jsx(b,{colSpan:6,className:"py-8 text-center font-sans text-gray-500",children:"Belum ada user yang tersedia"})})})]})})}),!K&&D.length>0&&e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Menampilkan ",e.jsx("span",{className:"font-medium text-foreground",children:m.from})," hingga"," ",e.jsx("span",{className:"font-medium text-foreground",children:m.to})," dari"," ",e.jsx("span",{className:"font-medium text-foreground",children:m.total})," user"]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"per-page",className:"text-sm font-medium",children:"Per halaman:"}),e.jsxs(f,{value:T.toString(),onValueChange:s=>oe(Number(s)),children:[e.jsx(j,{id:"per-page",className:"w-20 font-sans",children:e.jsx(g,{})}),e.jsxs(N,{children:[e.jsx(c,{value:"5",children:"5"}),e.jsx(c,{value:"10",children:"10"}),e.jsx(c,{value:"20",children:"20"}),e.jsx(c,{value:"50",children:"50"}),e.jsx(c,{value:"100",children:"100"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(1),disabled:h===1,className:"h-8 w-8 p-0",children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(s=>Math.max(1,s-1)),disabled:h===1,className:"h-8 w-8 p-0",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,m.last_page)},(s,t)=>{let a;return m.last_page<=5||h<=3?a=t+1:h>=m.last_page-2?a=m.last_page-4+t:a=h-2+t,e.jsx(i,{variant:h===a?"default":"outline",size:"sm",onClick:()=>y(a),className:`h-8 w-8 p-0 ${h===a?"bg-primary text-primary-foreground hover:bg-primary/90":""}`,children:a},a)})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(s=>Math.min(m.last_page,s+1)),disabled:h===m.last_page,className:"h-8 w-8 p-0",children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(m.last_page),disabled:h===m.last_page,className:"h-8 w-8 p-0",children:e.jsx(Ke,{className:"h-4 w-4"})})]})]})]})]})]})})]}),e.jsx(Ue,{open:ae,onOpenChange:S,children:e.jsx(Ae,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[800px]",children:e.jsxs("form",{onSubmit:xe,children:[e.jsxs(Re,{children:[e.jsx(Te,{className:"font-serif",children:u?"Edit Master User":"Tambah Master User Baru"}),e.jsx(Me,{className:"font-sans",children:u?"Perbarui informasi master user":"Tambahkan master user baru ke sistem"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",className:"font-sans",children:"Nama"}),e.jsx(F,{id:"name",name:"name",value:d.name,onChange:w,className:r.name?"border-red-500 font-sans":"font-sans",placeholder:"Masukkan nama lengkap"}),r.name&&e.jsx("p",{className:"text-sm text-red-500",children:r.name[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",className:"font-sans",children:"Email"}),e.jsx(F,{id:"email",name:"email",type:"email",value:d.email,onChange:w,className:r.email?"border-red-500 font-sans":"font-sans",placeholder:"masukkan@email.com"}),r.email&&e.jsx("p",{className:"text-sm text-red-500",children:r.email[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"password",className:"font-sans",children:["Password ",u&&"(kosongkan jika tidak ingin ubah)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:"password",name:"password",type:L?"text":"password",value:d.password,onChange:w,className:r.password?"border-red-500 pr-10 font-sans":"pr-10 font-sans",placeholder:"Masukkan password"}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute top-0 right-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>te(!L),children:L?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]}),r.password&&e.jsx("p",{className:"text-sm text-red-500",children:r.password[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"pin",className:"font-sans",children:"PIN (8 digit)"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:"pin",name:"pin",type:$?"text":"password",value:d.pin,onChange:w,maxLength:8,className:r.pin?"border-red-500 pr-10 font-sans":"pr-10 font-sans",placeholder:"12345678 (tidak harus unik)"}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute top-0 right-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>ne(!$),children:$?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]}),r.pin&&e.jsx("p",{className:"text-sm text-red-500",children:r.pin[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phone_number",className:"font-sans",children:"Nomor Telepon"}),e.jsx(F,{id:"phone_number",name:"phone_number",value:d.phone_number,onChange:w,className:r.phone_number?"border-red-500 font-sans":"font-sans",placeholder:"08123456789"}),r.phone_number&&e.jsx("p",{className:"text-sm text-red-500",children:r.phone_number[0]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(o,{htmlFor:"address",className:"font-sans",children:"Alamat"}),e.jsx(Le,{id:"address",name:"address",value:d.address,onChange:w,className:r.address?"border-red-500 font-sans":"font-sans",rows:3,placeholder:"Masukkan alamat lengkap"}),r.address&&e.jsx("p",{className:"text-sm text-red-500",children:r.address[0]})]}),e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{className:"font-sans font-medium",children:"User Authorization"}),e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:de,className:"gap-1 text-green-600 hover:bg-green-50",children:[e.jsx(We,{className:"h-4 w-4"}),"Tambah Auth"]})]}),d.user_auths.map((s,t)=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium",children:["Authorization #",t+1]}),d.user_auths.length>1&&e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:()=>me(t),className:"gap-1 text-red-600 hover:bg-red-50",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Hapus"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-sans text-sm",children:"Role"}),e.jsxs(f,{value:s.role_id===""?"":s.role_id.toString(),onValueChange:a=>M(t,"role_id",a),children:[e.jsx(j,{className:"font-sans",children:e.jsx(g,{placeholder:"Pilih Role"})}),e.jsx(N,{children:A&&A.length>0&&A.map(a=>e.jsx(c,{value:a.id.toString(),children:a.role_name},a.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-sans text-sm",children:"Company"}),e.jsxs(f,{value:s.company_id===""?"":s.company_id.toString(),onValueChange:a=>M(t,"company_id",a),children:[e.jsx(j,{className:"font-sans",children:e.jsx(g,{placeholder:"Pilih Company"})}),e.jsx(N,{children:E&&E.length>0&&E.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-sans text-sm",children:"Jabatan"}),e.jsxs(f,{value:s.jabatan_id===""?"":s.jabatan_id.toString(),onValueChange:a=>M(t,"jabatan_id",a),children:[e.jsx(j,{className:"font-sans",children:e.jsx(g,{placeholder:"Pilih Jabatan"})}),e.jsx(N,{children:R&&R.length>0&&R.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"font-sans text-sm",children:"Aplikasi"}),e.jsxs(f,{value:s.aplikasi_id===""?"":s.aplikasi_id.toString(),onValueChange:a=>M(t,"aplikasi_id",a),children:[e.jsx(j,{className:"font-sans",children:e.jsx(g,{placeholder:"Pilih Aplikasi"})}),e.jsx(N,{children:z&&z.length>0&&z.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]})]})]})]},t))]})]}),e.jsxs(De,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>S(!1),disabled:I,className:"font-sans",children:"Batal"}),e.jsx(i,{type:"submit",disabled:I,className:"bg-red-600 font-sans hover:bg-red-700",children:I?"Menyimpan...":u?"Perbarui":"Simpan"})]})]})})})]})]})}export{Us as default};
