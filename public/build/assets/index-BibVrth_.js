import{u as G,r as x,j as e,H as J,a as y}from"./app-CNJch6fJ.js";import{S as Q,N as W,A as Y,a as Z,B as E}from"./NotificationListener-CHbz9J81.js";import{S as ee}from"./site-header-1ZLAZI7i.js";import{B as T}from"./button-Bc8fY39k.js";import{C as f,a as N,b as k,d as j,c as se}from"./card-BdiGcNVe.js";import{I as ae}from"./input-L_-VHgZB.js";import{T as ne,a as te,b as _,c as oe}from"./tabs-C6wBaPMQ.js";import{s as V}from"./toast-CBrN9sog.js";import{I as L}from"./IconClock-CwJseAXp.js";import{I as M,a as B}from"./IconX-P1OgxuHH.js";import{I as re,a as le}from"./IconCalendar-ndBmsy-N.js";import{c as de}from"./createReactComponent-CAvr32i6.js";import{I as H}from"./IconFileText-CQlGGR13.js";import{I as ie}from"./IconUser-CFX-ui2T.js";import{I as ce}from"./IconEye-Bw4jvepO.js";/* empty css            */import"./index-BeHAPgjQ.js";import"./loader-circle-DS5R5jI-.js";import"./file-text-Cn-yV2BY.js";import"./user-BJizuUvm.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]],ue=de("outline","search","Search",me);function Le({approvals:g,stats:S,filters:P}){const{auth:b}=G().props,[D,U]=x.useState(P.search||""),[v,F]=x.useState(P.status||"all"),[m,C]=x.useState(g.data),[u,A]=x.useState(S),[O,w]=x.useState(new Set);x.useEffect(()=>{C(g.data),A(S)},[g.data,S]),x.useEffect(()=>{if(typeof window<"u"&&window.Echo&&b.user?.id){console.log("ðŸ“¡ Setting up real-time listeners for approvals");const s=`user.${b.user.id}.approvals`;console.log("ðŸ”§ Subscribing to user approvals channel:",s);const d=window.Echo.channel(s);window.Echo.connector?.pusher&&(window.Echo.connector.pusher.subscribe(s).bind("approval.created",n=>{console.log("ðŸŽ‰ðŸŽ‰ðŸŽ‰ APPROVAL.CREATED EVENT RECEIVED VIA PUSHER! ðŸŽ‰ðŸŽ‰ðŸŽ‰"),console.log("ðŸ†• Event data:",n),n.approval&&(C(t=>t.some(p=>p.id===n.approval.id)?(console.log("Approval already exists, skipping"),t):(console.log("âœ¨ Adding new approval to list"),[n.approval,...t])),A(t=>({...t,pending:t.pending+1})),w(t=>new Set(t).add(n.approval.id)),setTimeout(()=>{w(t=>{const a=new Set(t);return a.delete(n.approval.id),a})},3e3),n.approval.dokumen?.judul_dokumen&&V.success(`ðŸ†• Dokumen baru "${n.approval.dokumen.judul_dokumen}" perlu persetujuan Anda!`))}),console.log("âœ… Direct Pusher binding set for approval.created on channel:",s)),d.listen("approval.created",l=>{console.log("ðŸŽ‰ APPROVAL.CREATED via Echo.listen:",l)}),d.subscribed(()=>{console.log("âœ… Subscribed to user approvals channel:",s)}),d.error(l=>{console.error("âŒ User approvals channel subscription error:",l)});const h=[];return m.length>0&&(m.forEach(l=>{const n=`dokumen.${l.dokumen_id}`;if(!h.includes(n)){h.push(n);const t=window.Echo.channel(n);t.listen("dokumen.updated",a=>{if(console.log("ðŸ“¡ Real-time dokumen update received on approvals page:",a),a.dokumen?.id){if(console.log("ðŸ”„ Updating approval state smoothly for dokumen ID:",a.dokumen.id),C(r=>{const i=r.map(o=>{if(o.dokumen_id===a.dokumen.id){console.log("âœ¨ Found matching approval, updating dokumen data");const c=a.dokumen.approvals?.find(I=>I.id===o.id);return{...o,dokumen:{...o.dokumen,...a.dokumen,user:a.dokumen.user||o.dokumen.user,latest_version:a.dokumen.latestVersion||a.dokumen.latest_version||o.dokumen.latest_version},approval_status:c?.approval_status||o.approval_status}}return o});return console.log("âœ… Approvals state updated smoothly"),i}),a.dokumen.approvals){const r=a.dokumen.approvals.find(i=>i.user_id===b.user.id);r&&A(i=>{const o=m.find(I=>I.dokumen_id===a.dokumen.id);if(!o)return i;const c={...i};return o.approval_status==="pending"?c.pending--:o.approval_status==="approved"?c.approved--:o.approval_status==="rejected"&&c.rejected--,r.approval_status==="pending"?c.pending++:r.approval_status==="approved"?c.approved++:r.approval_status==="rejected"&&c.rejected++,c})}const p=m.find(r=>r.dokumen_id===a.dokumen.id);p&&(w(r=>new Set(r).add(p.id)),setTimeout(()=>{w(r=>{const i=new Set(r);return i.delete(p.id),i})},2e3))}if(a.dokumen?.judul_dokumen){const p=a.dokumen.status==="approved"?"telah disetujui":a.dokumen.status==="rejected"?"telah ditolak":"telah diupdate";V.success(`ðŸ“¡ Dokumen "${a.dokumen.judul_dokumen}" ${p}!`)}}),t.subscribed(()=>{console.log("âœ… Subscribed to dokumen channel:",n)})}}),console.log(`ðŸ“» Subscribed to ${h.length} dokumen channels`)),()=>{console.log("ðŸ”Œ Leaving user approvals channel:",s),window.Echo.leave(s),h.forEach(l=>{console.log("ðŸ”Œ Leaving dokumen channel:",l),window.Echo.leave(l)})}}},[m.length,b.user?.id]);const z=s=>{s.preventDefault(),y.get(route("approvals.index"),{search:D,status:v!=="all"?v:void 0},{preserveState:!0})},K=s=>{F(s),y.get(route("approvals.index"),{status:s!=="all"?s:void 0,search:D},{preserveState:!0})},X=s=>{y.visit(route("approvals.show",s))},R=s=>s?new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",q=s=>{const d={pending:{label:"Menunggu",className:"bg-yellow-100 text-yellow-800 border-yellow-300",icon:L},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 border-green-300",icon:M},rejected:{label:"Ditolak",className:"bg-red-100 text-red-800 border-red-300",icon:B}},{label:h,className:l,icon:n}=d[s]||d.pending;return e.jsxs(E,{variant:"outline",className:`font-sans ${l}`,children:[e.jsx(n,{className:"mr-1 h-3 w-3"}),h]})},$=s=>s?new Date(s)<new Date:!1;return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Approval Dokumen"}),e.jsxs(Q,{children:[e.jsx(W,{}),e.jsx(Y,{variant:"inset"}),e.jsxs(Z,{children:[e.jsx(ee,{}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsxs("div",{className:"@container/main flex flex-1 flex-col gap-6 p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"font-serif text-3xl font-bold",children:"Approval Dokumen"}),e.jsx("p",{className:"font-sans text-muted-foreground",children:"Kelola persetujuan dokumen yang memerlukan tindakan Anda"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"font-sans text-sm font-medium",children:"Menunggu"}),e.jsx(L,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"font-mono text-2xl font-bold",children:u.pending}),e.jsx("p",{className:"font-sans text-xs text-muted-foreground",children:"Perlu persetujuan"})]})]}),e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"font-sans text-sm font-medium",children:"Disetujui"}),e.jsx(M,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"font-mono text-2xl font-bold",children:u.approved}),e.jsx("p",{className:"font-sans text-xs text-muted-foreground",children:"Total disetujui"})]})]}),e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"font-sans text-sm font-medium",children:"Ditolak"}),e.jsx(B,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"font-mono text-2xl font-bold",children:u.rejected}),e.jsx("p",{className:"font-sans text-xs text-muted-foreground",children:"Total ditolak"})]})]}),e.jsxs(f,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"font-sans text-sm font-medium",children:"Terlambat"}),e.jsx(re,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"font-mono text-2xl font-bold",children:u.overdue}),e.jsx("p",{className:"font-sans text-xs text-muted-foreground",children:"Melewati deadline"})]})]})]}),e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(k,{className:"font-serif",children:"Daftar Approval"}),e.jsx(se,{className:"font-sans",children:"Dokumen yang memerlukan persetujuan Anda"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:z,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ae,{type:"text",placeholder:"Cari berdasarkan judul dokumen...",value:D,onChange:s=>U(s.target.value),className:"pl-10 font-sans"})]}),e.jsx(T,{type:"submit",className:"font-sans",children:"Cari"})]}),e.jsxs(ne,{value:v,onValueChange:K,children:[e.jsxs(te,{children:[e.jsx(_,{value:"all",className:"font-sans",children:"Semua"}),e.jsxs(_,{value:"pending",className:"font-sans",children:["Menunggu (",u.pending,")"]}),e.jsxs(_,{value:"approved",className:"font-sans",children:["Disetujui (",u.approved,")"]}),e.jsxs(_,{value:"rejected",className:"font-sans",children:["Ditolak (",u.rejected,")"]})]}),e.jsxs(oe,{value:v,className:"mt-6 space-y-4",children:[m.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(H,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 font-serif text-lg font-semibold",children:"Tidak ada dokumen"}),e.jsx("p",{className:"mt-2 font-sans text-sm text-muted-foreground",children:"Belum ada dokumen yang perlu di-approve pada kategori ini."})]}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsx(f,{className:`transition-all duration-500 hover:shadow-md ${O.has(s.id)?"bg-green-50 shadow-md dark:bg-green-950/20":""}`,children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(H,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h3",{className:"font-serif font-semibold",children:s.dokumen.judul_dokumen}),e.jsx("p",{className:"font-mono text-sm text-muted-foreground",children:s.dokumen.nomor_dokumen}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"font-sans",children:s.dokumen.user?.name||"-"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-sans",children:R(s.dokumen.tgl_pengajuan)})]}),s.masterflow_step&&e.jsxs(E,{variant:"outline",className:"font-sans",children:["Step ",s.masterflow_step.step_order,":"," ",s.masterflow_step.step_name]})]})]})]}),s.tgl_deadline&&e.jsxs("div",{className:`flex items-center gap-1 font-sans text-sm ${$(s.tgl_deadline)?"text-red-600":"text-muted-foreground"}`,children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:["Deadline: ",R(s.tgl_deadline)]}),$(s.tgl_deadline)&&e.jsx(E,{variant:"outline",className:"border-red-300 bg-red-50 text-red-700",children:"Terlambat"})]})]}),e.jsxs("div",{className:"flex shrink-0 flex-col items-end gap-3",children:[q(s.approval_status),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>X(s.id),className:"font-sans",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Lihat Detail"]})]})]})})},s.id))}),g.last_page>1&&e.jsx("div",{className:"flex items-center justify-center gap-2 pt-4",children:g.links.map((s,d)=>e.jsx(T,{variant:s.active?"default":"outline",size:"sm",disabled:!s.url,onClick:()=>s.url&&y.visit(s.url),className:"font-sans",dangerouslySetInnerHTML:{__html:s.label}},d))})]})]})]})]})]})})]})]})]})}export{Le as default};
