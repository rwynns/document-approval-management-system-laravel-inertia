import{c as s}from"./app-CNJch6fJ.js";function i(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return t?decodeURIComponent(t[1]):null}let a=!1;async function c(){try{await s.get("/sanctum/csrf-cookie",{withCredentials:!0}),a=!0}catch(e){console.warn("Failed to initialize CSRF protection:",e)}}async function u(){a=!1,await c()}const r=s.create({baseURL:"/api",withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}});r.interceptors.request.use(async e=>{a||await c();const t=document.cookie.match(/XSRF-TOKEN=([^;]+)/);if(t){const n=decodeURIComponent(t[1]);e.headers["X-XSRF-TOKEN"]=n}else{const n=i();n&&(e.headers["X-CSRF-TOKEN"]=n)}if(typeof window<"u"&&window.Echo){const n=window.Echo.socketId();n&&(e.headers["X-Socket-ID"]=n)}const o=localStorage.getItem("auth-token");return o&&(e.headers.Authorization=`Bearer ${o}`),e});r.interceptors.response.use(e=>e,async e=>{const t=e.config;if(e.response?.status===419&&!t._retry){t._retry=!0;try{await u();const o=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return o&&(t.headers["X-XSRF-TOKEN"]=decodeURIComponent(o[1])),r(t)}catch(o){return window.location.href="/login",Promise.reject(o)}}return e.response?.status===401&&(localStorage.removeItem("auth-token"),window.location.href="/login"),Promise.reject(e)});export{r as a};
