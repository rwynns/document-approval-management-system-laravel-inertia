import{u as Le,r as c,j as e,H as Re,L as ne,a as Ge}from"./app-CNJch6fJ.js";import{S as Be,N as Oe,A as He,a as Ue,B as R}from"./NotificationListener-CHbz9J81.js";import{S as ze}from"./site-header-1ZLAZI7i.js";import{B as p}from"./button-Bc8fY39k.js";import{C as D,d as C}from"./card-BdiGcNVe.js";import{D as oe,a as le,b as ie,c as de,d as ce,e as ue}from"./dialog-BDMnm7Fp.js";import{I as x}from"./input-L_-VHgZB.js";import{L as f}from"./label-Ch3Qpvdb.js";import{S as G,a as B,b as O,c as H,d as h}from"./select-DahuNLv9.js";import{T as Je,a as Ke,b as X,c as b,d as Ve,e as g}from"./table-dbNKOOTV.js";import{T as We}from"./textarea-2ialuiXC.js";import{a as E}from"./api-BCiONhZ8.js";import{s as m}from"./toast-CBrN9sog.js";import{I as q}from"./IconFileText-CQlGGR13.js";import{I as me}from"./IconPlus-DwaGKv2n.js";import{F as Xe}from"./file-text-Cn-yV2BY.js";import{U as qe}from"./user-BJizuUvm.js";import{C as Qe}from"./calendar-vegV-pg_.js";import{A as Ye}from"./activity-5R1ujG4d.js";import{S as Ze}from"./search-DwR1Q8ba.js";import{E as es}from"./eye-D7yVw-EQ.js";import{I as ss}from"./IconEdit-CcmCEER-.js";import{I as pe}from"./IconTrash-MfoBVftz.js";import{C as he}from"./circle-check-Bn1A0iOv.js";/* empty css            */import"./index-BeHAPgjQ.js";import"./loader-circle-DS5R5jI-.js";import"./createReactComponent-CAvr32i6.js";const Q={nomor_dokumen:"",judul_dokumen:"",masterflow_id:"",tgl_pengajuan:new Date().toISOString().split("T")[0],tgl_deadline:"",deskripsi:"",file:null,approvers:{},custom_approvers:[{email:"",order:1}],step_approvers:{}};function Fs(){const{auth:j}=Le().props,[k,U]=c.useState([]),[Y,fe]=c.useState([]),[xe,Z]=c.useState(!0),[ge,F]=c.useState(!1),[je,T]=c.useState(!1),[A,ee]=c.useState(null),[o,u]=c.useState(Q),[w,z]=c.useState(!1),[se,be]=c.useState("draft"),[d,N]=c.useState({}),[v,Ne]=c.useState(""),[I,ke]=c.useState("all"),[_,S]=c.useState(null),[J,$]=c.useState({}),[M,K]=c.useState({}),[we,P]=c.useState(new Set),V=async()=>{try{console.log("Fetching dokumen..."),Z(!0);const s=await E.get("/dokumen",{params:{my_documents:!0}});console.log("Dokumen fetched:",s.data);const r=s.data.data||s.data;console.log("üìä Total dokumen received:",r.length),console.log("üìä Dokumen list:",r.map(a=>({id:a.id,judul:a.judul_dokumen,status:a.status}))),U(r),console.log("‚úÖ State updated with new dokumen data")}catch(s){console.error("Error fetching dokumen:",s),m.error("‚ùå Failed to load documents. Please try again.")}finally{Z(!1)}},ve=async()=>{try{console.log("Fetching masterflows...");const s=await E.get("/masterflows");console.log("Masterflows fetched:",s.data),fe(s.data.masterflows||[])}catch(s){console.error("Error fetching masterflows:",s),m.error("‚ùå Failed to load masterflows.")}};c.useEffect(()=>{if(!j.user){console.log("No authenticated user found, redirecting to home"),m.error("‚ùå Please login first to access Documents."),window.location.href="/";return}if(console.log("Authenticated user found, loading data"),V(),ve(),typeof window<"u"&&window.Echo&&j.user?.id){console.log("üì° Setting up real-time listener for user dokumen:",j.user.id);const s=`user.${j.user.id}.dokumen`;console.log("üîß Creating channel:",s);const r=window.Echo.channel(s);if(console.log("üîß Channel object:",r),console.log("üîß Echo instance:",window.Echo),window.Echo.connector?.pusher){const a=window.Echo.connector.pusher.subscribe(s);console.log("üîß Pusher channel subscribed:",a),a.bind("dokumen.updated",t=>{if(console.log("üéâüéâüéâ PUSHER DIRECT LISTENER TRIGGERED! üéâüéâüéâ"),console.log("üì° Real-time dokumen update received:",t),console.log("üì° Event data:",JSON.stringify(t,null,2)),t.dokumen?.id&&(console.log("üîÑ Updating dokumen state smoothly for ID:",t.dokumen.id),U(n=>{const l=n.map(i=>i.id===t.dokumen.id?(console.log("‚ú® Found matching dokumen, updating:",{oldStatus:i.status,newStatus:t.dokumen.status,oldCurrentStep:i.detailed_status?.current_step_description,newCurrentStep:t.dokumen.detailed_status?.current_step_description}),{...i,...t.dokumen,user:t.dokumen.user||i.user,masterflow:t.dokumen.masterflow||i.masterflow,latest_version:t.dokumen.latest_version||i.latest_version,approvals:t.dokumen.approvals||i.approvals,detailed_status:t.dokumen.detailed_status||i.detailed_status}):i);return console.log("‚úÖ Dokumen state updated smoothly"),l}),P(n=>new Set(n).add(t.dokumen.id)),setTimeout(()=>{P(n=>{const l=new Set(n);return l.delete(t.dokumen.id),l})},2e3)),console.log("üîî Showing toast notification..."),t.dokumen?.judul_dokumen){const n=t.dokumen.status==="approved"?"disetujui":"diupdate";m.success(`üì° Dokumen "${t.dokumen.judul_dokumen}" telah ${n}!`)}else m.success("üì° Daftar dokumen telah diupdate secara real-time!");console.log("‚úÖ Toast notification triggered")}),a.bind("pusher:subscription_succeeded",()=>{console.log("‚úÖ Pusher subscription succeeded for:",s)}),a.bind("pusher:subscription_error",t=>{console.error("‚ùå Pusher subscription error:",t)})}return console.log("üéØ Attaching listener for event: dokumen.updated"),r.listen("dokumen.updated",a=>{if(console.log("üéâüéâüéâ CHANNEL LISTENER TRIGGERED! üéâüéâüéâ"),console.log("üì° Real-time dokumen update received:",a),console.log("üì° Event data:",JSON.stringify(a,null,2)),a.dokumen?.id&&(console.log("üîÑ Updating dokumen state smoothly for ID:",a.dokumen.id),U(t=>{const n=t.map(l=>l.id===a.dokumen.id?(console.log("‚ú® Found matching dokumen, updating:",{oldStatus:l.status,newStatus:a.dokumen.status,oldCurrentStep:l.detailed_status?.current_step_description,newCurrentStep:a.dokumen.detailed_status?.current_step_description}),{...l,...a.dokumen,user:a.dokumen.user||l.user,masterflow:a.dokumen.masterflow||l.masterflow,latest_version:a.dokumen.latest_version||l.latest_version,approvals:a.dokumen.approvals||l.approvals,detailed_status:a.dokumen.detailed_status||l.detailed_status}):l);return console.log("‚úÖ Dokumen state updated smoothly"),n}),P(t=>new Set(t).add(a.dokumen.id)),setTimeout(()=>{P(t=>{const n=new Set(t);return n.delete(a.dokumen.id),n})},2e3)),console.log("üîî Showing toast notification..."),a.dokumen?.judul_dokumen){const t=a.dokumen.status==="approved"?"disetujui":"diupdate";m.success(`üì° Dokumen "${a.dokumen.judul_dokumen}" telah ${t}!`)}else m.success("üì° Daftar dokumen telah diupdate secara real-time!");console.log("‚úÖ Toast notification triggered")}),r.subscribed(()=>{console.log("‚úÖ Successfully subscribed to channel:",s),console.log("‚úÖ Ready to receive real-time updates for user:",j.user.id)}),r.error(a=>{console.error("‚ùå Channel subscription error:",a)}),window.Echo.connector?.pusher&&(window.Echo.connector.pusher.connection.bind("connected",()=>{console.log("‚úÖ WebSocket connected successfully")}),window.Echo.connector.pusher.connection.bind("error",a=>{console.error("‚ùå WebSocket connection error:",a)}),window.Echo.connector.pusher.connection.bind("disconnected",()=>{console.warn("‚ö†Ô∏è WebSocket disconnected")}),window.Echo.connector.pusher.bind_global((a,t)=>{a.startsWith("pusher:")||(console.log("üîî Global event received:",a,t),console.log("üîî Event received on channel:",t?.channel||"unknown"),console.log("üîî Looking for listener on channel:",s),console.log("üîî Event name received:",a),console.log("üîî Expected event name: dokumen.updated"))})),console.log("üìª Subscribed to channel:",s),()=>{console.log("üîå Leaving channel:",s),window.Echo.connector?.pusher&&window.Echo.connector.pusher.unsubscribe(s),window.Echo.leave(s)}}else window.Echo||console.error("‚ùå window.Echo not initialized! Check app.tsx")},[j.user]);const y=s=>{const{name:r,value:a}=s.target;u(t=>({...t,[r]:a})),d[r]&&N(t=>({...t,[r]:[]}))},_e=s=>{s.target.files&&s.target.files[0]&&(u(r=>({...r,file:s.target.files[0]})),d.file&&N(r=>({...r,file:[]})))},Se=()=>{const s=new Date,r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),t=Math.floor(Math.random()*1e4).toString().padStart(4,"0");return`${r}${a}${t}`},ye=async s=>{if(s==="custom"){u(t=>({...t,masterflow_id:"custom",approvers:{},custom_approvers:[{email:"",order:1}]})),S(null),$({});return}const r=Number(s);u(t=>({...t,masterflow_id:r,approvers:{},custom_approvers:[]})),d.masterflow_id&&N(t=>({...t,masterflow_id:[]}));const a=Y.find(t=>t.id===r);if(a)try{const t=await E.get(`/masterflows/${r}/steps`);console.log("Masterflow steps:",t.data);const n={...a,steps:t.data.steps||[]};S(n);const l={};for(const i of n.steps||[])if(i.jabatan_id)try{const W=await E.get(`/users-by-jabatan/${i.jabatan_id}`);l[i.id]=W.data||[]}catch(W){console.error(`Error fetching users for jabatan ${i.jabatan_id}:`,W),l[i.id]=[]}$(l)}catch(t){console.error("Error fetching masterflow steps:",t),S({...a,steps:[]})}else S(null),$({})},ae=(s,r,a)=>{u(t=>{const n=[...t.custom_approvers];return n[s]={...n[s],[r]:a},{...t,custom_approvers:n}})},De=()=>{u(s=>({...s,custom_approvers:[...s.custom_approvers,{email:"",order:s.custom_approvers.length+1}]}))},Ce=s=>{u(r=>({...r,custom_approvers:r.custom_approvers.filter((a,t)=>t!==s).map((a,t)=>({...a,order:t+1}))}))},Ee=(s,r)=>{u(a=>({...a,approvers:{...a.approvers,[s]:r===""?"":Number(r)}}))},Fe=s=>{K(r=>{const t=(r[s]||"single")==="single"?"group":"single";return u(t==="single"?n=>{const l={...n.step_approvers};return delete l[s],{...n,step_approvers:l}}:n=>({...n,approvers:{...n.approvers,[s]:""}})),{...r,[s]:t}})},Te=(s,r,a)=>{u(t=>{const n=t.step_approvers[s]||{userIds:[],jenisGroup:null},l=a?[...n.userIds,r]:n.userIds.filter(i=>i!==r);return{...t,step_approvers:{...t.step_approvers,[s]:{...n,userIds:l}}}})},Ae=(s,r)=>{u(a=>{const t=a.step_approvers[s]||{userIds:[],jenisGroup:null};return{...a,step_approvers:{...a.step_approvers,[s]:{...t,jenisGroup:r}}}})},Ie=async()=>{try{await fetch("/sanctum/csrf-cookie",{credentials:"include"})}catch(r){console.warn("Failed to refresh CSRF token:",r)}const s={...Q,nomor_dokumen:Se(),tgl_pengajuan:new Date().toISOString().split("T")[0],custom_approvers:[{email:"",order:1}]};u(s),S(null),$({}),K({}),N({}),F(!0)},te=async(s,r)=>{s.preventDefault(),be(r),z(!0),N({});try{console.log("Refreshing CSRF token before form submission..."),await fetch("/sanctum/csrf-cookie",{credentials:"include"}),await new Promise(t=>setTimeout(t,100));const a=new FormData;a.append("nomor_dokumen",o.nomor_dokumen),a.append("judul_dokumen",o.judul_dokumen),a.append("tgl_pengajuan",o.tgl_pengajuan),a.append("tgl_deadline",o.tgl_deadline),a.append("deskripsi",o.deskripsi),a.append("submit_type",r),o.file&&a.append("file",o.file),o.masterflow_id==="custom"?(a.append("masterflow_id","custom"),o.custom_approvers.forEach((t,n)=>{a.append(`custom_approvers[${n}][email]`,t.email),a.append(`custom_approvers[${n}][order]`,t.order.toString())})):(a.append("masterflow_id",o.masterflow_id.toString()),Object.entries(o.step_approvers).forEach(([t,n])=>{n.userIds.length>0&&n.jenisGroup&&(console.log(`Adding group approvers for step ${t}:`,n),a.append(`step_approvers[${t}][jenis_group]`,n.jenisGroup),n.userIds.forEach((l,i)=>{a.append(`step_approvers[${t}][user_ids][${i}]`,l.toString())}))}),Object.entries(o.approvers).forEach(([t,n])=>{n!==""&&!o.step_approvers[Number(t)]&&(console.log(`Adding single approver for step ${t}:`,n),a.append(`approvers[${t}]`,n.toString()))})),console.log("Submitting document with type:",r),console.log("Form data summary:",{masterflow_id:o.masterflow_id,step_approvers:o.step_approvers,approvers:o.approvers,stepModes:M}),Ge.post("/api/dokumen",a,{forceFormData:!0,preserveState:!1,preserveScroll:!1,onSuccess:t=>{const n=r==="draft"?`üìù Dokumen "${o.judul_dokumen}" berhasil disimpan sebagai draft!`:`üéâ Dokumen "${o.judul_dokumen}" berhasil disubmit untuk approval!`;m.success(n),F(!1),u(Q),K({}),V()},onError:t=>{console.error("Form submission errors:",t),N(t);const n=t.error?.[0]||"Failed to create document. Please check the form.";m.error(`‚ùå ${n}`)},onFinish:()=>{z(!1)}})}catch(a){console.error("Form submission error:",a),z(!1),a.response?.status===419?m.error("‚ùå Session expired. Please refresh the page and try again."):m.error(`‚ùå Failed to save document. ${a.response?.data?.message||a.message}`)}},$e=s=>{ee(s),T(!0)},Me=async()=>{if(A)try{await E.delete(`/dokumen/${A.id}`),m.success(`üéâ Dokumen "${A.judul_dokumen}" berhasil dihapus!`),T(!1),ee(null),V()}catch(s){m.error(`‚ùå Failed to delete document. ${s.response?.data?.message||s.message}`)}},Pe=s=>{const r={draft:{label:"Draft",className:"bg-gray-100 text-gray-800 border-gray-300"},submitted:{label:"Submitted",className:"bg-blue-100 text-blue-800 border-blue-300"},under_review:{label:"Under Review",className:"bg-yellow-100 text-yellow-800 border-yellow-300"},approved:{label:"Approved",className:"bg-green-100 text-green-800 border-green-300"},rejected:{label:"Rejected",className:"bg-red-100 text-red-800 border-red-300"}},a=r[s]||r.draft;return e.jsx(R,{variant:"outline",className:`font-sans ${a.className}`,children:a.label})},re=k.filter(s=>{const r=s.judul_dokumen.toLowerCase().includes(v.toLowerCase())||s.deskripsi?.toLowerCase().includes(v.toLowerCase())||s.masterflow?.name.toLowerCase().includes(v.toLowerCase()),a=I==="all"||s.status===I;return r&&a}),L={total:k.length,draft:k.filter(s=>s.status==="draft").length,submitted:k.filter(s=>s.status==="submitted"||s.status==="under_review").length,approved:k.filter(s=>s.status==="approved").length};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"My Documents"}),e.jsxs(Be,{children:[e.jsx(Oe,{userId:j.user?.id}),e.jsx(He,{variant:"inset"}),e.jsxs(Ue,{children:[e.jsx(ze,{}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2 p-6",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"flex items-center gap-2 font-serif text-2xl font-bold tracking-tight text-foreground",children:[e.jsx(q,{className:"h-6 w-6 text-primary"}),"Dokumen Saya"]}),e.jsx("p",{className:"font-sans text-sm text-muted-foreground",children:"Kelola dan ajukan dokumen untuk persetujuan"})]}),e.jsxs(p,{onClick:Ie,className:"font-sans",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Buat Dokumen"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(D,{className:"border-border bg-card",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between space-y-0 p-6 pb-2",children:[e.jsx("h3",{className:"font-sans text-sm font-medium text-muted-foreground",children:"Total Dokumen"}),e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"font-sans text-2xl font-bold text-foreground",children:L.total})})]}),e.jsxs(D,{className:"border-border bg-card",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between space-y-0 p-6 pb-2",children:[e.jsx("h3",{className:"font-sans text-sm font-medium text-muted-foreground",children:"Draft"}),e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"font-sans text-2xl font-bold text-foreground",children:L.draft})})]}),e.jsxs(D,{className:"border-border bg-card",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between space-y-0 p-6 pb-2",children:[e.jsx("h3",{className:"font-sans text-sm font-medium text-muted-foreground",children:"Menunggu Persetujuan"}),e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"font-sans text-2xl font-bold text-foreground",children:L.submitted})})]}),e.jsxs(D,{className:"border-border bg-card",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between space-y-0 p-6 pb-2",children:[e.jsx("h3",{className:"font-sans text-sm font-medium text-muted-foreground",children:"Disetujui"}),e.jsx(Ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(C,{children:e.jsx("div",{className:"font-sans text-2xl font-bold text-foreground",children:L.approved})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(x,{placeholder:"Cari dokumen...",value:v,onChange:s=>Ne(s.target.value),className:"pl-10 font-sans"})]}),e.jsxs(G,{value:I,onValueChange:ke,children:[e.jsx(B,{className:"w-[180px] font-sans",children:e.jsx(O,{placeholder:"Filter Status"})}),e.jsxs(H,{children:[e.jsx(h,{value:"all",className:"font-sans",children:"Semua Status"}),e.jsx(h,{value:"draft",className:"font-sans",children:"Draft"}),e.jsx(h,{value:"submitted",className:"font-sans",children:"Submitted"}),e.jsx(h,{value:"approved",className:"font-sans",children:"Approved"}),e.jsx(h,{value:"rejected",className:"font-sans",children:"Rejected"})]})]})]}),e.jsx("div",{className:"space-y-6",children:xe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading dokumen..."})]})}):e.jsx(D,{className:"border-border bg-card",children:e.jsx(C,{className:"p-0",children:e.jsxs(Je,{children:[e.jsx(Ke,{children:e.jsxs(X,{children:[e.jsx(b,{className:"w-16 font-sans",children:"No"}),e.jsx(b,{className:"min-w-64 font-sans",children:"Judul Dokumen"}),e.jsx(b,{className:"w-48 font-sans",children:"Masterflow"}),e.jsx(b,{className:"w-40 font-sans",children:"Status"}),e.jsx(b,{className:"min-w-64 font-sans",children:"Current Step"}),e.jsx(b,{className:"w-40 font-sans",children:"Tanggal Pengajuan"}),e.jsx(b,{className:"w-32 text-right font-sans",children:"Aksi"})]})}),e.jsx(Ve,{children:re.length>0?re.map((s,r)=>e.jsxs(X,{className:`transition-all duration-500 ${we.has(s.id)?"bg-green-50 dark:bg-green-950/20":""}`,children:[e.jsx(g,{className:"font-mono",children:r+1}),e.jsx(g,{className:"font-sans",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:s.judul_dokumen}),s.deskripsi&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.deskripsi.substring(0,80),s.deskripsi.length>80?"...":""]})]})}),e.jsx(g,{className:"font-sans",children:s.masterflow?.name||"-"}),e.jsx(g,{className:"font-sans",children:Pe(s.status)}),e.jsx(g,{className:"font-sans",children:s.detailed_status?.current_step_description?e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:s.detailed_status.current_step_description})}):s.detailed_status?.is_fully_approved?e.jsx("span",{className:"text-xs font-medium text-green-600",children:"‚úì Semua sudah approve"}):s.detailed_status?.is_rejected?e.jsx("span",{className:"text-xs font-medium text-red-600",children:"‚úó Ditolak"}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx(g,{className:"font-sans",children:new Date(s.tgl_pengajuan).toLocaleDateString("id-ID")}),e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ne,{href:`/api/dokumen/${s.id}`,children:e.jsx(p,{variant:"outline",size:"sm",className:"h-8 w-8 border-blue-300 p-0 text-blue-600 hover:bg-blue-50",children:e.jsx(es,{className:"h-4 w-4"})})}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{href:`/dokumen/${s.id}/edit`,children:e.jsx(p,{variant:"outline",size:"sm",className:"h-8 w-8 border-green-300 p-0 text-green-600 hover:bg-green-50",children:e.jsx(ss,{className:"h-4 w-4"})})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>$e(s),className:"h-8 w-8 border-red-300 p-0 text-red-600 hover:bg-red-50",children:e.jsx(pe,{className:"h-4 w-4"})})]})]})})]},s.id)):e.jsx(X,{children:e.jsx(g,{colSpan:7,className:"py-8 text-center font-sans text-gray-500",children:v||I!=="all"?"Tidak ada dokumen yang sesuai dengan filter":'Belum ada dokumen. Klik "Buat Dokumen" untuk memulai.'})})})]})})})})]})})}),e.jsx(oe,{open:ge,onOpenChange:F,children:e.jsx(le,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[800px]",children:e.jsxs("form",{onSubmit:s=>s.preventDefault(),children:[e.jsxs(ie,{children:[e.jsx(de,{className:"font-serif",children:"Buat Dokumen Baru"}),e.jsx(ce,{className:"font-sans",children:"Isi form di bawah untuk membuat dokumen baru. Klik simpan setelah selesai."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"nomor_dokumen",className:"font-sans",children:"Nomor Dokumen"}),e.jsx(x,{id:"nomor_dokumen",name:"nomor_dokumen",value:o.nomor_dokumen,onChange:y,className:"font-mono",placeholder:"Auto-generated",readOnly:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"tgl_pengajuan",className:"font-sans",children:"Tanggal Pengajuan"}),e.jsx(x,{id:"tgl_pengajuan",name:"tgl_pengajuan",type:"date",value:o.tgl_pengajuan,onChange:y,className:"font-sans"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(f,{htmlFor:"judul_dokumen",className:"font-sans",children:["Judul Dokumen ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"judul_dokumen",name:"judul_dokumen",value:o.judul_dokumen,onChange:y,className:d.judul_dokumen?"border-red-500 font-sans":"font-sans",placeholder:"Jurnal Besar Keuangan"}),d.judul_dokumen&&e.jsx("p",{className:"text-sm text-red-500",children:d.judul_dokumen[0]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(f,{htmlFor:"tgl_deadline",className:"font-sans",children:["Deadline ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"tgl_deadline",name:"tgl_deadline",type:"date",value:o.tgl_deadline,onChange:y,className:d.tgl_deadline?"border-red-500 font-sans":"font-sans"}),d.tgl_deadline&&e.jsx("p",{className:"text-sm text-red-500",children:d.tgl_deadline[0]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(f,{htmlFor:"masterflow_id",className:"font-sans",children:["Masterflow ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:o.masterflow_id===""?"":o.masterflow_id.toString(),onValueChange:ye,children:[e.jsx(B,{className:d.masterflow_id?"border-red-500 font-sans":"font-sans",children:e.jsx(O,{placeholder:"Pilih masterflow"})}),e.jsxs(H,{children:[Y.map(s=>e.jsx(h,{value:s.id.toString(),className:"font-sans",children:s.name},s.id)),e.jsx(h,{value:"custom",className:"font-sans font-medium text-primary",children:"‚ú® Custom Approval"})]})]}),d.masterflow_id&&e.jsx("p",{className:"text-sm text-red-500",children:d.masterflow_id[0]})]}),o.masterflow_id!==""&&o.masterflow_id!=="custom"&&_&&_.steps&&_.steps.length>0&&e.jsxs("div",{className:"grid gap-4 rounded-lg border border-border bg-muted/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"font-sans font-semibold",children:"Alur Persetujuan"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[_.steps.length," tahap persetujuan"]})]}),_.steps.sort((s,r)=>s.step_order-r.step_order).map((s,r)=>e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-[80px_1fr_1fr_40px] items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 font-mono text-sm font-medium text-primary",children:r+1})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Jabatan"}),e.jsx("div",{className:"rounded-md border border-border bg-background px-3 py-2 font-sans text-sm",children:s.jabatan?.name||"Sekertaris"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:M[s.id]==="group"?"Group Approval":"Nama Approval"}),e.jsx(p,{type:"button",size:"sm",variant:"ghost",onClick:()=>Fe(s.id),className:"h-6 px-2 text-xs",children:M[s.id]==="group"?"üë§ Single":"üë• Group"})]}),M[s.id]==="group"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{value:o.step_approvers[s.id]?.jenisGroup||"",onValueChange:a=>Ae(s.id,a),children:[e.jsx(B,{className:"font-sans",children:e.jsx(O,{placeholder:"Pilih jenis group"})}),e.jsxs(H,{children:[e.jsx(h,{value:"all_required",className:"font-sans",children:"‚úì Semua Harus Approve"}),e.jsx(h,{value:"any_one",className:"font-sans",children:"1Ô∏è‚É£ Salah Satu Saja"}),e.jsxs(h,{value:"majority",className:"font-sans",children:["üìä Mayoritas (",">"," 50%)"]})]})]}),e.jsx("div",{className:"rounded-md border border-border bg-background",children:e.jsxs("div",{className:"max-h-40 space-y-1 overflow-y-auto p-2",children:[(J[s.id]||[]).map(a=>e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded px-2 py-1.5 hover:bg-muted",children:[e.jsx("input",{type:"checkbox",checked:o.step_approvers[s.id]?.userIds.includes(a.id)||!1,onChange:t=>Te(s.id,a.id,t.target.checked),className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{className:"text-sm",children:a.name})]},a.id)),(J[s.id]||[]).length===0&&e.jsx("div",{className:"px-2 py-3 text-center text-sm text-muted-foreground",children:"Tidak ada approver tersedia"})]})}),o.step_approvers[s.id]?.userIds.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs(R,{variant:"secondary",children:[o.step_approvers[s.id].userIds.length," approver dipilih"]}),o.step_approvers[s.id]?.jenisGroup&&e.jsxs(R,{variant:"outline",className:"border-blue-400",children:[o.step_approvers[s.id].jenisGroup==="all_required"&&"Semua",o.step_approvers[s.id].jenisGroup==="any_one"&&"Salah Satu",o.step_approvers[s.id].jenisGroup==="majority"&&"Mayoritas"]})]})]}):e.jsxs(G,{value:o.approvers[s.id]===""?"":o.approvers[s.id]?.toString()||"",onValueChange:a=>Ee(s.id,a),children:[e.jsx(B,{className:"font-sans",children:e.jsx(O,{placeholder:"Pilih approver"})}),e.jsx(H,{children:(J[s.id]||[]).map(a=>e.jsx(h,{value:a.id.toString(),className:"font-sans",children:a.name},a.id))})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(R,{variant:"outline",className:"h-8 w-8 justify-center border-primary/30 font-mono text-xs",children:r+1})})]})},s.id))]}),o.masterflow_id==="custom"&&e.jsxs("div",{className:"grid gap-4 rounded-lg border border-border bg-muted/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"font-sans font-semibold",children:"Custom Approval Flow"}),e.jsxs(p,{type:"button",size:"sm",variant:"outline",onClick:De,className:"h-8 font-sans",children:[e.jsx(me,{className:"mr-1 h-3 w-3"}),"Tambah Approver"]})]}),e.jsx("div",{className:"space-y-3",children:o.custom_approvers.map((s,r)=>e.jsxs("div",{className:"grid grid-cols-[80px_1fr_100px_40px] items-start gap-3",children:[e.jsx("div",{className:"flex items-center justify-center pt-2",children:e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 font-mono text-sm font-medium text-primary",children:r+1})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Email Approver"}),e.jsx(x,{type:"email",value:s.email,onChange:a=>ae(r,"email",a.target.value),placeholder:"approver@example.com",className:"font-sans"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Tingkat"}),e.jsx(x,{type:"number",min:"1",value:s.order,onChange:a=>ae(r,"order",Number(a.target.value)),className:"font-sans"})]}),e.jsx("div",{className:"flex items-center justify-center pt-6",children:o.custom_approvers.length>1&&e.jsx(p,{type:"button",size:"sm",variant:"ghost",onClick:()=>Ce(r),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",children:e.jsx(pe,{className:"h-4 w-4"})})})]},r))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"* Masukkan email approver dan atur tingkat persetujuan (1 = tingkat pertama, 2 = tingkat kedua, dst.)"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"deskripsi",className:"font-sans",children:"Tambahkan Komentar"}),e.jsx(We,{id:"deskripsi",name:"deskripsi",value:o.deskripsi,onChange:y,className:d.deskripsi?"border-red-500 font-sans":"font-sans",placeholder:"Lapor bapak,,",rows:4}),d.deskripsi&&e.jsx("p",{className:"text-sm text-red-500",children:d.deskripsi[0]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(f,{htmlFor:"file",className:"font-sans",children:["Upload File ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"file",name:"file",type:"file",onChange:_e,className:d.file?"border-red-500 font-sans":"font-sans",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX (Max 10MB)"}),d.file&&e.jsx("p",{className:"text-sm text-red-500",children:d.file[0]})]})]}),e.jsxs(ue,{className:"sm:justify-between",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>F(!1),disabled:w,className:"font-sans",children:"Batal"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:s=>te(s,"draft"),disabled:w,className:"border-gray-300 font-sans hover:bg-gray-50",children:w&&se==="draft"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Menyimpan Draft..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Simpan sebagai Draft"]})}),e.jsx(p,{type:"button",onClick:s=>te(s,"submit"),disabled:w,className:"bg-green-600 font-sans hover:bg-green-700",children:w&&se==="submit"?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4 animate-spin"}),"Mengirim..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Submit untuk Approval"]})})]})]})]})})}),e.jsx(oe,{open:je,onOpenChange:T,children:e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(de,{className:"font-serif",children:"Hapus Dokumen"}),e.jsxs(ce,{className:"font-sans",children:['Apakah Anda yakin ingin menghapus dokumen "',e.jsx("strong",{children:A?.judul_dokumen}),'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(ue,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>T(!1),className:"font-sans",children:"Batal"}),e.jsx(p,{type:"button",variant:"destructive",onClick:Me,className:"font-sans",children:"Hapus"})]})]})})]})]})]})}export{Fs as default};
