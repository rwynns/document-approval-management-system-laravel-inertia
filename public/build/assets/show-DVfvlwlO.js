import{r as u,j as e,b as re,a as ie,H as De}from"./app-CNJch6fJ.js";import{S as Ce,N as Te,A as Ie,a as Ae,c as Pe,d as $e,B as D,b as le}from"./NotificationListener-CHbz9J81.js";import{I as de,P as Fe}from"./pdf-viewer-Bn6ykAGa.js";import{B as o}from"./button-Bc8fY39k.js";import{C as f,d as j,a as C,b as T,c as oe}from"./card-BdiGcNVe.js";import{L as y}from"./label-Ch3Qpvdb.js";import{T as Me,a as Oe,b as ce,c as me}from"./tabs-C6wBaPMQ.js";import{s as w}from"./toast-CBrN9sog.js";import{c as Le}from"./createReactComponent-CAvr32i6.js";import{I as ue}from"./IconUpload-0pPEbrfm.js";import{I as Be}from"./IconTrash-MfoBVftz.js";import{S as Ee}from"./site-header-1ZLAZI7i.js";import{D as xe,a as he,b as pe,c as ge,d as fe,e as Re}from"./dialog-BDMnm7Fp.js";import{T as ee}from"./textarea-2ialuiXC.js";import{I as se}from"./IconFileText-CQlGGR13.js";import{a as Ge,I as je}from"./IconCalendar-ndBmsy-N.js";import{I as F,a as H}from"./IconX-P1OgxuHH.js";import{I as be}from"./IconEye-Bw4jvepO.js";import{C as Ne}from"./circle-x-CSWeUvJ8.js";import{C as ze}from"./circle-check-Bn1A0iOv.js";import{I as V}from"./IconClock-CwJseAXp.js";import{I as Ue}from"./IconUsers-DGqKWc1T.js";/* empty css            */import"./index-BeHAPgjQ.js";import"./loader-circle-DS5R5jI-.js";import"./file-text-Cn-yV2BY.js";import"./user-BJizuUvm.js";import"./tiny-invariant-CopsF_GD.js";import"./chevron-left-B3CqyqQr.js";import"./chevron-right-D5vTS9_Z.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]],X=Le("outline","pencil","Pencil",He);function Ve({onSignatureComplete:a,onCancel:I}){const x=u.useRef(null),[W,_]=u.useState(!1),[M,A]=u.useState([]),[ae,S]=u.useState(!1),[b,k]=u.useState("draw"),[m,p]=u.useState(null),[J,K]=u.useState(!1);u.useEffect(()=>{Y()},[]),u.useEffect(()=>{b==="draw"&&R()},[b]);const R=()=>{const t=x.current;if(!t)return;const i=t.getContext("2d");i&&(t.width=600,t.height=200,i.strokeStyle="#000000",i.lineWidth=2,i.lineCap="round",i.lineJoin="round",i.fillStyle="#ffffff",i.fillRect(0,0,t.width,t.height),K(!0))},Y=async()=>{try{const i=await(await fetch(route("signatures.index"))).json();A(i.signatures||[]);const l=i.signatures?.find(N=>N.is_default);l&&(p(l),k("saved"))}catch(t){console.error("Failed to fetch signatures:",t)}},O=(t,i)=>{const l=i.getBoundingClientRect(),N="touches"in t?t.touches[0].clientX:t.clientX,g="touches"in t?t.touches[0].clientY:t.clientY,P=i.width/l.width,h=i.height/l.height,U=(N-l.left)*P,$=(g-l.top)*h;return{x:U,y:$}},G=t=>{t.preventDefault();const i=x.current;if(!i)return;const l=i.getContext("2d");if(!l)return;l.strokeStyle="#000000",l.lineWidth=2,l.lineCap="round",l.lineJoin="round",_(!0);const{x:N,y:g}=O(t,i);l.beginPath(),l.moveTo(N,g)},z=t=>{if(!W)return;t.preventDefault();const i=x.current;if(!i)return;const l=i.getContext("2d");if(!l)return;const{x:N,y:g}=O(t,i);l.lineTo(N,g),l.stroke()},L=()=>{_(!1)},q=()=>{const t=x.current;if(!t)return;const i=t.getContext("2d");i&&(i.fillStyle="#ffffff",i.fillRect(0,0,t.width,t.height))},Q=()=>{const t=x.current;if(!t)return;const i=t.toDataURL("image/png"),l=t.getContext("2d");if(!l)return;const g=l.getImageData(0,0,t.width,t.height).data;let P=!0;for(let h=0;h<g.length;h+=4)if(g[h]!==255||g[h+1]!==255||g[h+2]!==255){P=!1;break}if(P){w.error("âŒ Silakan gambar tanda tangan terlebih dahulu");return}a(i)},B=()=>{if(!m){w.error("âŒ Silakan pilih tanda tangan terlebih dahulu");return}const t=m.signature_url.startsWith("http")?m.signature_url:`${window.location.origin}${m.signature_url}`;a(t)};return e.jsx("div",{className:"space-y-4",children:e.jsxs(Me,{value:b,onValueChange:t=>k(t),children:[e.jsxs(Oe,{className:"grid h-auto w-full grid-cols-2 gap-1 p-1",children:[e.jsxs(ce,{value:"draw",className:"h-auto py-2.5 text-center font-sans leading-tight whitespace-normal",children:[e.jsx(X,{className:"mr-2 hidden h-4 w-4 shrink-0 sm:inline"}),e.jsx("span",{children:"Gambar Tanda Tangan"})]}),e.jsxs(ce,{value:"saved",className:"h-auto py-2.5 text-center font-sans leading-tight whitespace-normal",children:[e.jsx(ue,{className:"mr-2 hidden h-4 w-4 shrink-0 sm:inline"}),e.jsx("span",{children:"Tanda Tangan Tersimpan"})]})]}),e.jsxs(me,{value:"draw",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"font-sans",children:"Gambar tanda tangan Anda di bawah ini"}),e.jsx(f,{children:e.jsxs(j,{className:"p-4",children:[e.jsx("canvas",{ref:x,onMouseDown:G,onMouseMove:z,onMouseUp:L,onMouseLeave:L,onTouchStart:G,onTouchMove:z,onTouchEnd:L,className:"w-full cursor-crosshair touch-none rounded border border-dashed border-gray-300 bg-white",style:{height:"200px"}}),e.jsx("div",{className:"mt-3 flex justify-end gap-2",children:e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:q,className:"font-sans",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Hapus"]})})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",children:[I&&e.jsx(o,{type:"button",variant:"outline",onClick:I,className:"font-sans",children:"Batal"}),e.jsx(o,{type:"button",onClick:Q,className:"font-sans",children:"Gunakan Tanda Tangan Ini"})]})]}),e.jsxs(me,{value:"saved",className:"space-y-4",children:[M.length===0?e.jsx(f,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 font-serif text-lg font-semibold",children:"Belum ada tanda tangan tersimpan"}),e.jsx("p",{className:"mt-2 text-center font-sans text-sm text-muted-foreground",children:'Anda belum memiliki tanda tangan tersimpan. Silakan buat tanda tangan baru di tab "Gambar Tanda Tangan" atau kelola tanda tangan Anda di halaman Pengaturan.'})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{className:"font-sans",children:"Pilih tanda tangan yang akan digunakan"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:M.map(t=>e.jsx(f,{className:`cursor-pointer transition-all ${m?.id===t.id?"border-primary ring-2 ring-primary ring-offset-2":"hover:border-gray-400"}`,onClick:()=>p(t),children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"relative flex aspect-[3/1] items-center justify-center rounded border bg-white",children:[e.jsx("img",{src:t.signature_url.startsWith("http")?t.signature_url:`${window.location.origin}${t.signature_url}`,alt:"Signature",className:"max-h-full max-w-full object-contain"}),t.is_default&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"rounded bg-primary px-2 py-1 font-sans text-xs text-white",children:"Default"})})]}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"font-sans text-xs text-muted-foreground",children:t.signature_type==="manual"?"Tanda tangan manual":"Tanda tangan upload"})})]})},t.id))})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",children:[I&&e.jsx(o,{type:"button",variant:"outline",onClick:I,className:"font-sans",children:"Batal"}),e.jsx(o,{type:"button",onClick:B,disabled:!m||M.length===0,className:"font-sans",children:"Gunakan Tanda Tangan Ini"})]})]})]})})}function ks({approval:a,allApprovals:I,canApprove:x}){const[W,_]=u.useState(!1),[M,A]=u.useState(!1),[ae,S]=u.useState(!1),[b,k]=u.useState(null),m=re({comment:"",signature:""}),p=re({alasan_reject:"",comment:""});u.useEffect(()=>{if(typeof window<"u"&&window.Echo&&a?.dokumen?.id){console.log("ðŸ“¡ Setting up real-time listener for dokumen:",a.dokumen.id);const s=`dokumen.${a.dokumen.id}`,r=window.Echo.channel(s);return r.listen("dokumen.updated",d=>{console.log("ðŸ“¡ Real-time dokumen update received on approval page:",d),ie.visit(window.location.href,{preserveScroll:!0}),d.dokumen?.judul_dokumen&&w.success(`ðŸ“¡ Dokumen "${d.dokumen.judul_dokumen}" telah diupdate!`)}),r.subscribed(()=>{console.log("âœ… Successfully subscribed to channel:",s)}),r.error(d=>{console.error("âŒ Channel subscription error:",d)}),console.log("ðŸ“» Subscribed to channel:",s),()=>{console.log("ðŸ”Œ Leaving channel:",s),window.Echo.leave(s)}}else window.Echo||console.error("âŒ window.Echo not initialized! Check app.tsx")},[a?.dokumen?.id]);const[J,K]=u.useState(null),[R,Y]=u.useState(""),[O,G]=u.useState(null),z=s=>{k(s),m.setData("signature",s),S(!1),w.success("âœ… Tanda tangan berhasil ditambahkan!")},L=()=>{if(!b){w.error("âŒ Silakan tanda tangani dokumen terlebih dahulu");return}console.log("Submitting approval with signature:",{signatureLength:b.length,signaturePreview:b.substring(0,50)+"...",hasComment:!!m.data.comment}),m.data.signature=b,m.post(route("approvals.approve",a.id),{preserveScroll:!0,onSuccess:()=>{w.success("âœ… Dokumen berhasil disetujui!"),A(!1),k(null),S(!1)},onError:s=>{console.error("Approval error:",s);const r=s.error||s.signature||s.message||"Gagal menyetujui dokumen";w.error(`âŒ ${r}`)}})},q=()=>{p.post(route("approvals.reject",a.id),{preserveScroll:!0,onSuccess:()=>{w.success("âœ… Dokumen berhasil ditolak!"),_(!1)},onError:()=>{w.error("âŒ Gagal menolak dokumen.")}})},Q=()=>{a.dokumen_version&&(window.location.href=`/api/dokumen/${a.dokumen.id}/download/${a.dokumen_version.id}`)},B=s=>{const r=s||a.dokumen_version;if(!r)return;const d=r.tipe_file.toLowerCase();if(d==="pdf"||d==="application/pdf"){const n=`/api/dokumen/${a.dokumen.id}/signed-pdf/${r.id}`;K(n),Y(r.nama_file),G(r.id),A(!0)}else w.error("âŒ Preview hanya tersedia untuk file PDF.")},t=s=>s?new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",i=s=>{if(!s)return"-";const r=new Date(s),d=r.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),n=r.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${d}, ${n} WIB`},l=s=>{if(s===0)return"0 Bytes";const r=1024,d=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(r));return Math.round(s/Math.pow(r,n)*100)/100+" "+d[n]},N=s=>{const r={pending:{label:"Menunggu",className:"bg-yellow-100 text-yellow-800 border-yellow-300",icon:V},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 border-green-300",icon:F},skipped:{label:"Disetujui",className:"bg-green-100 text-green-800 border-green-300",icon:F},rejected:{label:"Ditolak",className:"bg-red-100 text-red-800 border-red-300",icon:H},waiting:{label:"Menunggu Giliran",className:"bg-gray-100 text-gray-800 border-gray-300",icon:V}},{label:d,className:n,icon:v}=r[s]||r.pending;return e.jsxs(D,{variant:"outline",className:`font-sans ${n}`,children:[e.jsx(v,{className:"mr-1 h-3 w-3"}),d]})},g=a.tgl_deadline&&new Date(a.tgl_deadline)<new Date,P=[...I||[]].sort((s,r)=>s.masterflow_step&&r.masterflow_step?s.masterflow_step.step_order-r.masterflow_step.step_order:0),h={},U=[];P.forEach(s=>{const r=s.masterflow_step?.step_order??0;s.group_index?(h[s.group_index]||(h[s.group_index]={approvals:[],firstStepOrder:r,groupType:s.jenis_group||"parallel"}),h[s.group_index].approvals.push(s),r<h[s.group_index].firstStepOrder&&(h[s.group_index].firstStepOrder=r)):U.push({approval:s,stepOrder:r})});const $=[];Object.entries(h).forEach(([s,r])=>{$.push({item:{type:"group",data:r.approvals,groupIndex:s,groupType:r.groupType,firstStepOrder:r.firstStepOrder},stepOrder:r.firstStepOrder})}),U.forEach(({approval:s,stepOrder:r})=>{$.push({item:{type:"single",data:s},stepOrder:r})}),$.sort((s,r)=>s.stepOrder-r.stepOrder);const te=$.map(({item:s})=>s),ve=s=>{switch(s){case"any_one":return"Salah Satu Setuju";case"all_required":return"Semua Harus Setuju";case"majority":return"Mayoritas Setuju";default:return"Harus Setuju"}};return e.jsxs(e.Fragment,{children:[e.jsx(De,{title:`Approval - ${a.dokumen.judul_dokumen}`}),e.jsxs(Ce,{children:[e.jsx(Te,{}),e.jsx(Ie,{variant:"inset"}),e.jsxs(Ae,{children:[e.jsx(Ee,{}),e.jsxs("div",{className:"flex flex-1 flex-col gap-6 p-4 sm:p-6",children:[e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground sm:text-sm",children:[e.jsx(o,{variant:"link",className:"h-auto p-0 text-xs text-muted-foreground sm:text-sm",onClick:()=>ie.visit(route("approvals.index")),children:"Approval Saya"}),e.jsx("span",{children:"/"}),e.jsx("span",{children:"Detail"})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("h1",{className:"font-serif text-2xl leading-tight font-bold tracking-tight text-foreground sm:text-3xl",children:a.dokumen.judul_dokumen}),e.jsx("div",{className:"shrink-0",children:N(a.approval_status)})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-xs text-muted-foreground sm:flex-row sm:items-center sm:gap-4 sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(se,{className:"h-3.5 w-3.5 shrink-0 sm:h-4 sm:w-4"}),e.jsx("span",{className:"truncate font-mono",children:a.dokumen.nomor_dokumen})]}),e.jsx("span",{className:"hidden sm:inline",children:"â€¢"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ge,{className:"h-3.5 w-3.5 shrink-0 sm:h-4 sm:w-4"}),e.jsxs("span",{children:["Pengajuan: ",t(a.dokumen.tgl_pengajuan)]})]})]})]})}),g&&a.approval_status==="pending"&&e.jsx(f,{className:"border-red-200 bg-red-50",children:e.jsxs(j,{className:"flex items-center gap-3 p-4",children:[e.jsx(je,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-sans font-semibold text-red-900",children:"Deadline Terlewat!"}),e.jsxs("p",{className:"font-sans text-sm text-red-700",children:["Approval ini melewati deadline pada ",t(a.tgl_deadline)]})]})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(f,{children:[e.jsx(C,{children:e.jsx(T,{className:"font-serif text-lg",children:"Informasi Dokumen"})}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(y,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Pengaju"}),e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Pe,{className:"h-6 w-6",children:e.jsx($e,{className:"text-[10px]",children:a.dokumen.user?.name?.substring(0,2).toUpperCase()})}),e.jsx("span",{children:a.dokumen.user?.name||"-"})]}),a.dokumen.user?.profile?.jabatan&&e.jsx("p",{className:"pl-8 text-xs text-muted-foreground",children:a.dokumen.user.profile.jabatan})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(y,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Deadline Approval"}),e.jsx("div",{className:"font-medium",children:a.tgl_deadline?e.jsx("span",{className:g?"font-bold text-red-600":"",children:t(a.tgl_deadline)}):"-"})]})]}),a.dokumen.deskripsi&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(y,{className:"text-xs font-medium tracking-wider text-muted-foreground uppercase",children:"Deskripsi"}),e.jsx("div",{className:"rounded-md bg-muted/30 p-4 text-sm leading-relaxed text-foreground",children:a.dokumen.deskripsi})]})]})]}),a.dokumen_version&&e.jsxs(f,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"font-serif text-lg",children:"File Dokumen"}),a.dokumen_version.signed_file_url&&e.jsxs(D,{variant:"outline",className:"border-green-300 bg-green-50 text-green-700",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Sudah Ditandatangani"]})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col gap-4 rounded-lg border bg-muted/10 p-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 shrink-0 items-center justify-center rounded-lg bg-blue-100 text-blue-600",children:e.jsx(se,{className:"h-6 w-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate font-medium text-foreground",title:a.dokumen_version.nama_file,children:a.dokumen_version.nama_file}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:["v",a.dokumen_version.version]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:a.dokumen_version.tipe_file.toUpperCase()}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:l(a.dokumen_version.size_file)})]})]})]}),e.jsxs("div",{className:"flex shrink-0 justify-end gap-2",children:[(a.dokumen_version.tipe_file.toLowerCase()==="pdf"||a.dokumen_version.tipe_file.toLowerCase()==="application/pdf")&&e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>B(a.dokumen_version),title:"Preview",children:e.jsx(be,{className:"h-5 w-5"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:Q,title:"Download",children:e.jsx(de,{className:"h-5 w-5"})})]})]})})]}),a.dokumen.versions&&a.dokumen.versions.length>0&&e.jsxs(f,{children:[e.jsx(C,{children:e.jsx(T,{className:"font-serif text-lg",children:"Riwayat Versi"})}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:a.dokumen.versions.sort((s,r)=>new Date(r.tgl_upload).getTime()-new Date(s.tgl_upload).getTime()).map((s,r)=>{const d=r===0,n=a.dokumen.revision_logs?.find(v=>v.dokumen_version_id===s.id&&v.action==="rejected");return e.jsxs("div",{className:`flex flex-col gap-2 p-4 ${d?"bg-blue-50/30":"hover:bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex h-10 w-10 shrink-0 items-center justify-center rounded-lg border ${d?"border-blue-200 bg-blue-100 text-blue-700":n?"border-red-200 bg-red-100 text-red-700":"bg-background text-muted-foreground"}`,children:e.jsx(se,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Versi ",s.version]}),d&&e.jsx(D,{variant:"secondary",className:"bg-blue-100 text-blue-700 hover:bg-blue-100",children:"Latest"}),n&&e.jsx(D,{variant:"destructive",className:"border-red-200 bg-red-100 text-red-700 hover:bg-red-200",children:"Rejected"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.nama_file}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:l(s.size_file)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t(s.tgl_upload)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[(s.tipe_file.toLowerCase()==="pdf"||s.tipe_file.toLowerCase()==="application/pdf")&&e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>B(s),children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>window.location.href=`/dokumen/${a.dokumen.id}/download/${s.id}`,children:e.jsx(de,{className:"h-4 w-4"})})]})]}),n&&e.jsxs("div",{className:"ml-14 rounded-md border border-red-200 bg-red-50 p-2.5 text-xs text-red-800",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-1.5 font-semibold text-red-900",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Ditolak oleh ",n.user?.name||"Unknown"]})]}),e.jsx("p",{className:"leading-relaxed",children:n.notes})]})]},s.id)})})})]}),e.jsxs(f,{children:[e.jsxs(C,{children:[e.jsx(T,{className:"font-serif text-lg",children:"Timeline Persetujuan"}),e.jsx(oe,{children:"Proses approval untuk dokumen ini"})]}),e.jsx(j,{children:e.jsx("div",{className:"relative space-y-0 pl-2",children:te.map((s,r)=>{const d=r===te.length-1;if(s.type==="single"){const n=s.data,v=n.approval_status==="approved"||n.approval_status==="skipped",E=n.approval_status==="rejected",Z=n.approval_status==="pending";return e.jsxs("div",{className:"relative flex gap-4 pb-8 last:pb-0",children:[!d&&e.jsx("div",{className:"absolute top-8 bottom-0 left-[15px] -ml-px w-0.5 bg-border"}),e.jsx("div",{className:`relative z-10 flex h-8 w-8 shrink-0 items-center justify-center rounded-full border-2 bg-background ${v?"border-green-600 text-green-600":E?"border-red-600 text-red-600":Z?"border-yellow-500 text-yellow-500":"border-muted text-muted-foreground"}`,children:v?e.jsx(ze,{className:"h-4 w-4"}):E?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx("span",{className:"text-xs font-bold",children:r+1})}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-1.5 pt-1",children:[e.jsxs("div",{className:"flex min-w-0 items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate font-sans text-sm font-semibold sm:text-base",children:n.masterflow_step?.step_name||"Custom Approver"}),e.jsx("div",{className:"truncate text-xs font-medium text-foreground sm:text-sm",children:n.user?.name||n.user?.email||"-"}),n.masterflow_step?.jabatan&&e.jsx("div",{className:"text-[10px] text-muted-foreground sm:text-xs",children:n.masterflow_step.jabatan.name})]}),e.jsx("div",{className:"shrink-0",children:N(n.approval_status)})]}),n.tgl_approve&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-muted-foreground sm:text-xs",children:[e.jsx(V,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{children:[v?"Disetujui":"Ditolak"," pada"," ",i(n.tgl_approve)]})]}),(n.comment||n.alasan_reject)&&e.jsxs("div",{className:`mt-2 rounded-md border p-3 text-sm ${E?"border-red-200 bg-red-50 text-red-900":"border-border bg-muted/30"}`,children:[n.alasan_reject&&e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold text-red-700",children:"Alasan Penolakan:"})," ",n.alasan_reject]}),n.comment&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Komentar:"})," ",n.comment]})]}),n.id===a.id&&e.jsx("div",{className:"mt-2",children:e.jsx(D,{variant:"outline",className:"border-primary text-[10px] text-primary",children:"Posisi Anda"})})]})]},n.id)}else{const n=s,v=n.data.every(c=>c.approval_status==="approved"||c.approval_status==="skipped"),E=n.data.some(c=>c.approval_status==="rejected"),Z=n.data.some(c=>c.approval_status==="approved"),we=(n.groupType==="any_one"?Z:v)?"border-green-600 text-green-600":E?"border-red-600 text-red-600":"border-yellow-500 text-yellow-500";return e.jsxs("div",{className:"relative flex gap-4 pb-8 last:pb-0",children:[!d&&e.jsx("div",{className:"absolute top-8 bottom-0 left-[15px] -ml-px w-0.5 bg-border"}),e.jsx("div",{className:`relative z-10 flex h-8 w-8 shrink-0 items-center justify-center rounded-full border-2 bg-background ${we}`,children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1 pt-1",children:e.jsxs("div",{className:"mb-4 rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between border-b bg-muted/20 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:n.data[0]?.masterflow_step?.step_name||"Group Approval"}),e.jsx(D,{variant:"outline",className:"h-5 px-1.5 text-[10px] tracking-wide uppercase",children:ve(n.groupType)})]})}),e.jsx("div",{className:"divide-y p-0",children:n.data.map(c=>{const ke=n.groupType==="any_one",ye=n.data.some(ne=>ne.id!==c.id&&ne.approval_status==="approved"),_e=ke&&ye&&c.approval_status==="pending",Se=c.approval_status==="skipped"||_e;return e.jsxs("div",{className:"flex flex-col gap-2 p-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:c.user?.name||c.masterflow_step?.jabatan?.name||"Unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c.masterflow_step?.jabatan?.name}),Se&&e.jsx("div",{className:"text-[10px] text-muted-foreground italic",children:"*Otomatis di-skip karena grup sudah menyelesaikan approval."})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[N(c.approval_status),c.tgl_approve&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:i(c.tgl_approve)}),c.id===a.id&&e.jsx(D,{variant:"outline",className:"border-primary text-[10px] text-primary",children:"Posisi Anda"})]})]},c.id)})})]})})]},`group-${n.groupIndex}`)}})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[x&&a.approval_status==="pending"?e.jsxs(f,{className:"border-primary shadow-md",children:[e.jsxs(C,{className:"bg-primary/5 pb-3",children:[e.jsxs(T,{className:"flex items-center gap-2 text-base font-bold text-primary sm:text-lg",children:[e.jsx(X,{className:"h-4 w-4 shrink-0 sm:h-5 sm:w-5"}),"Tindakan Diperlukan"]}),e.jsx(oe,{className:"text-xs sm:text-sm",children:"Dokumen ini menunggu persetujuan Anda."})]}),e.jsxs(j,{className:"space-y-3 pt-6",children:[e.jsxs(o,{onClick:()=>B(),className:"w-full bg-primary hover:bg-primary/90",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Setujui Dokumen"]}),e.jsxs(o,{variant:"outline",onClick:()=>_(!0),className:"w-full border-red-200 text-red-600 hover:border-red-300 hover:bg-red-50 hover:text-red-700",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Tolak Dokumen"]})]})]}):e.jsxs(f,{className:`border shadow-sm ${a.approval_status==="approved"?"border-green-200 bg-green-50/50":a.approval_status==="rejected"?"border-red-200 bg-red-50/50":a.approval_status==="waiting"||a.approval_status==="pending"&&!x?"border-yellow-200 bg-yellow-50/50":"border-dashed bg-muted/30"}`,children:[e.jsx(C,{className:"pb-3",children:e.jsxs(T,{className:`flex items-center gap-2 text-base font-bold ${a.approval_status==="approved"?"text-green-700":a.approval_status==="rejected"?"text-red-700":a.approval_status==="waiting"||a.approval_status==="pending"&&!x?"text-yellow-700":"text-muted-foreground"}`,children:[a.approval_status==="approved"?e.jsx(F,{className:"h-5 w-5"}):a.approval_status==="rejected"?e.jsx(H,{className:"h-5 w-5"}):a.approval_status==="waiting"||a.approval_status==="pending"&&!x?e.jsx(V,{className:"h-5 w-5"}):e.jsx(je,{className:"h-5 w-5"}),"Status Anda"]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[a.approval_status==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-green-900",children:"Disetujui"}),e.jsxs("p",{className:"text-sm text-green-700",children:["Anda telah menyetujui dokumen ini pada ",t(a.tgl_approve)]})]}),a.approval_status==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-red-900",children:"Ditolak"}),e.jsxs("p",{className:"text-sm text-red-700",children:["Anda menolak dokumen ini pada ",t(a.tgl_approve)]})]}),(a.approval_status==="waiting"||a.approval_status==="pending"&&!x)&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold text-yellow-900",children:"Menunggu Giliran"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Anda belum dapat melakukan persetujuan karena tahap sebelumnya belum selesai."})]})]})})]}),e.jsxs(f,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(T,{className:"text-sm font-medium",children:"Bantuan"})}),e.jsxs(j,{className:"space-y-2 text-xs text-muted-foreground",children:[e.jsx("p",{children:"â€¢ Preview dokumen untuk membaca isi lengkap sebelum menyetujui."}),e.jsx("p",{children:"â€¢ Anda wajib membubuhkan tanda tangan digital saat menyetujui."}),e.jsx("p",{children:"â€¢ Jika menolak, Anda wajib menyertakan alasan penolakan."})]})]})]})]})]}),e.jsx(xe,{open:W,onOpenChange:_,children:e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ge,{className:"font-serif",children:"Tolak Dokumen"}),e.jsxs(fe,{className:"font-sans",children:['Silakan berikan alasan penolakan dokumen "',a.dokumen.judul_dokumen,'"']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"alasan_reject",className:"font-sans",children:["Alasan Penolakan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ee,{id:"alasan_reject",placeholder:"Jelaskan alasan penolakan dokumen...",value:p.data.alasan_reject,onChange:s=>p.setData("alasan_reject",s.target.value),className:"font-sans",rows:4,required:!0}),p.errors.alasan_reject&&e.jsx("p",{className:"font-sans text-sm text-red-600",children:p.errors.alasan_reject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"reject_comment",className:"font-sans",children:"Komentar Tambahan (Opsional)"}),e.jsx(ee,{id:"reject_comment",placeholder:"Tambahkan komentar jika diperlukan...",value:p.data.comment,onChange:s=>p.setData("comment",s.target.value),className:"font-sans",rows:3})]})]}),e.jsxs(Re,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>_(!1),className:"font-sans",children:"Batal"}),e.jsx(o,{type:"button",onClick:q,disabled:p.processing||!p.data.alasan_reject,className:"border-red-300 bg-red-600 font-sans hover:bg-red-700",children:p.processing?"Memproses...":"Tolak Dokumen"})]})]})}),e.jsx(xe,{open:M,onOpenChange:s=>{A(s),s||(S(!1),k(null))},children:e.jsxs(he,{className:"flex h-[90vh] max-w-[90vw] flex-col p-0",children:[e.jsx(pe,{className:"shrink-0 border-b p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(ge,{className:"font-serif",children:"Preview Dokumen"}),e.jsx(fe,{className:"font-sans",children:R||a.dokumen_version?.nama_file}),a.approval_status!=="pending"&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-2 text-xs text-blue-700",children:["Dokumen ini sudah ",a.approval_status==="approved"?"disetujui":"ditolak","."]}),!x&&a.approval_status==="pending"&&e.jsx("div",{className:"rounded-md bg-yellow-50 p-2 text-xs text-yellow-700",children:"Approval ini bukan untuk Anda atau sedang menunggu giliran."})]})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 overflow-hidden p-4 lg:flex-row",children:[e.jsx("div",{className:`${x&&a.approval_status==="pending"?"min-h-[300px] flex-1 lg:h-auto":"w-full"} overflow-auto rounded-lg border`,children:J&&e.jsx(Fe,{fileUrl:J,fileName:R||"document.pdf",showControls:!0,height:"100%"})}),x&&a.approval_status==="pending"&&(O===a.dokumen_version?.id||!O)&&e.jsxs("div",{className:"w-full shrink-0 space-y-4 overflow-auto rounded-lg border bg-muted/20 p-4 lg:w-[400px]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-serif text-lg font-semibold",children:"Tanda Tangan Persetujuan"}),e.jsx("p",{className:"font-sans text-sm text-muted-foreground",children:"Tanda tangani dokumen untuk menyetujuinya"})]}),e.jsx(le,{}),!ae&&!b?e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{className:"border-dashed",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"mt-2 text-center font-sans text-sm text-muted-foreground",children:"Belum ada tanda tangan"})]})}),e.jsxs(o,{type:"button",onClick:()=>S(!0),className:"w-full font-sans",variant:"outline",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Tambah Tanda Tangan"]})]}):b?e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{children:e.jsx(j,{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-center rounded border bg-white p-4",children:e.jsx("img",{src:b,alt:"Signature",className:"max-h-24 max-w-full object-contain"})})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>{k(null),S(!0)},className:"flex-1 font-sans",children:"Ganti"}),e.jsx(o,{type:"button",variant:"outline",onClick:()=>{k(null),m.setData("signature","")},className:"font-sans text-red-600 hover:bg-red-50",children:e.jsx(H,{className:"h-4 w-4"})})]})]}):e.jsx(Ve,{onSignatureComplete:z,onCancel:()=>S(!1)}),b&&e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"preview-comment",className:"font-sans",children:"Komentar (Opsional)"}),e.jsx(ee,{id:"preview-comment",placeholder:"Tambahkan komentar jika diperlukan...",value:m.data.comment,onChange:s=>m.setData("comment",s.target.value),className:"font-sans",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{type:"button",onClick:L,disabled:m.processing,className:"w-full font-sans",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),m.processing?"Memproses...":"Setujui Dokumen"]}),e.jsx(o,{type:"button",variant:"outline",onClick:()=>A(!1),className:"w-full font-sans",disabled:m.processing,children:"Batal"})]})]})]})]})]})]})})]})]})]})}export{ks as default};
